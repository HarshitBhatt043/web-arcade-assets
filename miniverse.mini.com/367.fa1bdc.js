"use strict";(self._c=self._c||[]).push([[367],{56067:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("playerState",(()=>({isNetworked:!0,value:{state:0}})))},10631:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("state",(()=>({isNetworked:!0,value:{state:0,objectName:""}})))},84169:(e,t,a)=>{a.d(t,{Z:()=>i});var o=a(53393),n=a(7962),s=a(45799);const i=(0,o.J4)("trs",(()=>({value:{translation:n.Ue(),scale:n.Ue(),rotation:s.Ue()}})))},72506:(e,t,a)=>{a.d(t,{Z:()=>i});var o=a(53393),n=a(7962),s=a(45799);const i=(0,o.J4)("trsCache",(()=>({value:{frameNo:0,trs:{translation:n.Ue(),scale:n.Ue(),rotation:s.Ue()}}})))},42748:(e,t,a)=>{a.d(t,{Z:()=>i});var o=a(53393),n=a(7962),s=a(45799);const i=(0,o.J4)("trsError",(()=>({value:{translation:n.Ue(),scale:n.Ue(),rotation:s.Ue()}})))},47088:(e,t,a)=>{a.d(t,{Av:()=>o,TD:()=>n,rC:()=>s});const o=!1,n=.3,s=6},82407:(e,t,a)=>{a.d(t,{R:()=>n,V:()=>s});let o=null;function n(e){o=e}function s(){return o}},2934:(e,t,a)=>{var o;a.d(t,{g:()=>o}),function(e){e.FRONT_LEFT="FRONT_LEFT",e.FRONT_RIGHT="FRONT_RIGHT",e.BACK_LEFT="BACK_LEFT",e.BACK_RIGHT="BACK_RIGHT"}(o||(o={}))},33805:(e,t,a)=>{function o(e){return JSON.parse(JSON.stringify(e))}function n(e,t){for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const o=a;"object"==typeof t[o]&&null!==t[o]?n(e[o],t[o]):e[o]=t[o]}}a.d(t,{Q:()=>o,p:()=>n})},82934:(e,t,a)=>{a.d(t,{Y:()=>n});let o=!0;function n(e){o=e}},79276:(e,t,a)=>{function o(e,t){for(const a of e)if(t(a))return a;return null}a.d(t,{c:()=>o})},67991:(e,t,a)=>{function o(e,t,a){return(a=Math.min(Math.max((a-e)/(t-e),0),1))*a*(3-2*a)}a.d(t,{C:()=>o})},38755:(e,t,a)=>{a.d(t,{S1:()=>s,Y_:()=>l,_K:()=>i,b2:()=>n,jQ:()=>r});var o=a(7962);const n=o.al(1,0,0),s=o.al(0,1,0),i=o.al(0,0,1),r=o.al(0,0,0);function l(e,t,a){a*=4,o.t8(e,t[a],t[a+1],t[a+2])}},75550:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("activeTrigger",(()=>({value:{}})))},89262:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("animationData",(()=>({value:{clips:{}}})))},28697:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("boostPad",(()=>({isNetworked:!0,value:{multiplier:2}})))},11837:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("cameraTrigger",(()=>({isNetworked:!0,value:{distance:0,minDistance:0,stiffness:0,highSpeedAngle:0,lowSpeedAngle:0}})))},24974:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("carWorker",(()=>({isNetworked:!0,value:{spawnTime:Date.now()}})))},82417:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("carEffectSprite",(()=>({value:{particleCollectibleId:null,colorCollectibleId:null}})))},61728:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("carInput",(()=>({isNetworked:!0,value:{throttle:0,steering:0,brake:!1,horn:!1}})))},95233:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("carModelSwitch",(()=>({isNetworked:!0,value:{frameNo:null,collectibleId:null}})))},34769:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("carSelect",(()=>({value:{}})))},65958:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("carVisualizerTrigger",(()=>({isNetworked:!0,value:{resourceId:null,targetName:null}})))},71107:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("checkpoint",(()=>({isNetworked:!0,value:{index:0}})))},22857:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("crown",(()=>({isNetworked:!0,value:{targetDuration:10,taken:!1}})))},32429:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("crownHolderWorker",(()=>({isNetworked:!0,value:{targetDuration:null,frameOfAcquisition:0}})))},86904:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("crownVisual",(()=>({value:{}})))},75921:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("curlingCenter",(()=>({isNetworked:!0,value:{translation2d:[0,0],radius:0}})))},1205:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("curlingSpawnEndPoint",(()=>({isNetworked:!0,value:{translation:null,rotation:null}})))},95831:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("curlingSpawnStartPoint",(()=>({isNetworked:!0,value:{translation:null,rotation:null}})))},4424:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("disableCarInput",(()=>({isNetworked:!0,value:{}})))},94772:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("disclaimer",(()=>({value:{disclaimerId:null}})))},79007:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("dropTrigger",(()=>({value:{resourceId:null}})))},44963:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("dynamicObjectReset",(()=>({isNetworked:!0,value:{resetAfterFrames:0,lastResetFrameNo:0,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0}}})))},18148:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("emoji",(()=>({value:{timeAdded:0,spawnIndex:0,sourceEntity:null,origin:null,initRotation:0,initPhase:0}})))},8430:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("expandedInput",(()=>({isNetworked:!0,sharedBuffer:null,value:{lastChangedFrameNo:0,value:{light:{value:!1,changed:!1},horn:{value:!1,changed:!1},w:{value:!1,changed:!1},a:{value:!1,changed:!1},s:{value:!1,changed:!1},d:{value:!1,changed:!1},h:{value:!1,changed:!1},c:{value:!1,changed:!1}," ":{value:!1,changed:!1},arrowleft:{value:!1,changed:!1},arrowright:{value:!1,changed:!1},arrowup:{value:!1,changed:!1},arrowdown:{value:!1,changed:!1},joystickH:{value:0,changed:!1},joystickV:{value:0,changed:!1},g:{value:!1,changed:!1},chat:{value:"",changed:!1},startCurling:{value:!1,changed:!1},endCurling:{value:!1,changed:!1},submitCurling:{value:!1,changed:!1},startRacing:{value:!1,changed:!1},endRacing:{value:!1,changed:!1},leaveMuralWall:{value:!1,changed:!1}}}})))},79514:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("frameBasedAnimation",(()=>({isNetworked:!0,value:{animationStates:[]}})))},22971:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("gameobject",(()=>({isNetworked:!0,value:{objectName:void 0,objectId:void 0,objectType:void 0,collectible:void 0}})))},10562:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("ghostMode",(()=>({isNetworked:!0,value:{removeInFrameNo:0}})))},26068:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("hotspot",(()=>({isNetworked:!0,value:{trigger:null}})))},75903:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("icySurface",(()=>({isNetworked:!0,value:{forward:1,side:1,turn:1}})))},52782:(e,t,a)=>{a.d(t,{P:()=>o});const o=(0,a(53393).J4)("keyState",(()=>({value:{}})))},12103:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("muralFocus",(()=>({isNetworked:!0,value:{muralWallId:null,timeAdded:Date.now()}})))},57306:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("muralHotspot",(()=>({isNetworked:!0,value:{muralWallId:null}})))},96033:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("muralWall",(()=>({isNetworked:!0,value:{id:null,translation:null,rotation:null}})))},93295:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("networkId",(()=>({isNetworked:!0,value:{networkId:0}})))},75622:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("notificationTrigger",(()=>({isNetworked:!0,value:{notificationName:null}})))},68199:(e,t,a)=>{a.d(t,{Z:()=>s});var o=a(53393),n=a(5473);const s=(0,o.J4)("oldCar",(()=>({isNetworked:!0,value:{...n.v2,wheels:[],forceValue:0,steerValue:0}})))},19292:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("oledScreen",(()=>({value:{resourceId:null}})))},34173:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("particleTrail",(()=>({value:{timeAdded:0,spawnIndex:0,sourceEntity:null,matrix:null,initPhase:0,initRotation:0,radius:0,respawned:!0,dying:!1}})))},89649:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("particleTrailEmitter",(()=>({value:{particleCollectibleId:null,colorCollectibleId:null}})))},2375:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("physicsObject",(()=>({isNetworked:!0,sharedBuffer:void 0,value:{bodyType:void 0,colliders:void 0,translation:void 0,rotation:void 0,linvel:void 0,angvel:void 0,isTranslationLocked:!1,isRotationLocked:!1}})))},15474:(e,t,a)=>{(0,a(53393).J4)("inputBundle",(()=>({value:[]})))},40137:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("playersToRemove",(()=>({value:[]})))},72303:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("playersToSpawn",(()=>({value:[]})))},43715:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("portal",(()=>({isNetworked:!0,value:{levelName:null,random:!1}})))},85903:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("quizAnswerTrigger",(()=>({value:{quizId:null,correctAnswer:!1}})))},19784:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("race",(()=>({isNetworked:!0,value:{timeLimitInFrames:0,finishIndex:0,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0}}})))},16319:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("rapierRigidBody",(()=>({value:{rigidbody:null,colliderGroups:[],isTranslationLocked:!1,isRotationLocked:!1}})))},3096:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("remoteInputs",(()=>({value:[]})))},39038:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("rotationAnimation",(()=>({isNetworked:!0,value:{axis:null,speed:null}})))},61371:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("serverSnapshot",(()=>({value:{type:null,snapshot:null,futureSnapshot:null,inputBuffer:null,playersToSpawn:null,playersToRemove:null}})))},41465:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("spawnAnimation",(()=>({value:{time:-1.5,rings:{}}})))},31215:(e,t,a)=>{a.d(t,{I:()=>o,Z:()=>s});var o,n=a(53393);!function(e){e[e.custom=0]="custom",e[e.portal=1]="portal",e[e.charger=2]="charger",e[e.quiz=3]="quiz",e[e.random=4]="random"}(o||(o={}));const s=(0,n.J4)("spawnPoint",(()=>({isNetworked:!0,value:{type:null,name:null,group:null,translation:null,rotation:null,speed:null}})))},41624:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("spawnTrigger",(()=>({isNetworked:!0,value:{spawnPointName:null}})))},17579:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("staticUntilHit",(()=>({isNetworked:!0,value:{}})))},30144:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("target",(()=>({isNetworked:!0,value:{name:null,type:null,resourceId:null}})))},23569:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("targetFollower",(()=>({isNetworked:!0,value:null})))},91331:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("timeBasedAnimation",(()=>({value:{animationStates:[],onComplete:null,isComplete:!1}})))},17803:(e,t,a)=>{a.d(t,{Z:()=>s});var o=a(53393),n=a(7962);const s=(0,o.J4)("translationAnimation",(()=>({value:{axis:null,speed:null,distance:1,t:0,direction:!0,originalTranslation:n.Ue()}})))},28857:(e,t,a)=>{a.d(t,{Z:()=>o});const o=(0,a(53393).J4)("trigger",(()=>({isNetworked:!0,value:{triggerType:"boostPad",lockCar:!1}})))},80523:(e,t,a)=>{a.d(t,{Z:()=>s});var o=a(53393),n=a(2934);const s=(0,o.J4)("wheel",(()=>({value:{index:0,type:n.g.FRONT_LEFT,offset:[0,0,0],distance:0,angle:0,speed:0}})))},34689:(e,t,a)=>{a.d(t,{Z:()=>o});const o=new(a(53393).q3)},84888:(e,t,a)=>{a.d(t,{Z:()=>n});const o={instance:null,loadRapier:new Promise((e=>{a.e(376).then(a.bind(a,95376)).then((t=>{o.instance=t,e(t)}))}))},n=o},86582:(e,t,a)=>{a.d(t,{_o:()=>r,nw:()=>i,ot:()=>l,p0:()=>s});const o=[],n=[];function s(){return o}function i(e){o.push({type:e.type,data:e})}function r(e){n.push({type:e.type,data:e})}function l(){o.length=0;for(let e=0;e<n.length;e++)o.push(n[e]);n.length=0}},6472:(e,t,a)=>{a.d(t,{Z:()=>c});var o=a(14206),n=a.n(o),s=a(73251),i=a(86582),r=a(28876);const l=new class{achievements=[];async getAllAchievements(e=!0){return e?n().get(`${s.xN}/getAllAchievements`).then((e=>{const t=e.data;return this.achievements=t||[],(0,i.nw)({type:r.p.AchievementsLoaded,achievements:t}),this.achievements})):[...this.achievements]}getAchievement(e){return this.achievements.find((t=>t.id===e))}getAllAchievementsSync(){return[...this.achievements]}setAllAchievements(e){this.achievements=e}};l.getAllAchievements();const c=l},92903:(e,t,a)=>{a.d(t,{c:()=>h});var o=a(7962),n=a(45799),s=a(21839),i=a(81308),r=a(60320),l=a(48366),c=a(67991),d=a(86582),u=a(28876),f=a(73251),g=a(85080),p=a(59252),Z=a(43397);const h=new class{resultCameraTR={position:[0,0,0],rotation:[0,0,0,1]};workCameraTR={position:[0,0,0],rotation:[0,0,0,1]};cameraTRByFrameNo=new Map;states=[];fov=0;near=0;far=0;setState(e,t=!0){this.clearStates(t),this.addState(e)}addState(e){const t={...e,weight:0,frameNo:g.Z.get(p.Z).value.current};this.states.push(t)}clearStates(e=!0){this.states=e?this.states.filter((e=>e.isDefault)):[]}popState(e=!0){e&&this.states.length&&this.states[this.states.length-1].isDefault||this.states.pop()}update(e){let t=this.cameraTRByFrameNo.has(e-1)&&this.cameraTRByFrameNo.get(e-1);if(!t){const e=i.Z.get(r.Z).value;t={position:o.Ue(),rotation:n.Ue()},s.i0(t.position,e),s.j6(t.rotation,e)}let a=this.states.length,g=0;if(!a)return;for(let t=0;t<a;t++){const o=this.states[t];o.weight=0===o.transitionDuration?1:(0,l.V2)((e-o.frameNo)*f.yn/o.transitionDuration),1===o.weight&&(this.states[t-1]&&!this.states[t-1].isDefault&&this.states.splice(t-1,1).length&&(t--,a--,g--),g=t)}const{resultCameraTR:p,workCameraTR:h}=this;let y=0,v=0,m=0,b=g+1;b=b<a?b:g;for(let t=g;t<=b;t++){const a=this.states[t];if(a.baseController.update(f.yn,h,i.Z,e),a.additiveControllers?.forEach((e=>{e.update(f.yn,h,h,i.Z)})),t===g)o.JG(p.position,h.position),n.JG(p.rotation,h.rotation),y=a.fov,v=a.near,m=a.far;else{const e=(0,c.C)(0,1,a.weight);o.t7(p.position,p.position,h.position,e),n.ZA(p.rotation,p.rotation,h.rotation,e),y=(0,l.t7)(y,a.fov,e),v=(0,l.t7)(v,a.near,e),m=(0,l.t7)(m,a.far,e)}}const w=i.Z.getMutable(r.Z).value;s.yl(w,this.resultCameraTR.rotation,this.resultCameraTR.position),this.cameraTRByFrameNo.set(e,this.resultCameraTR);const I=e-Math.ceil((0,Z.J2)()/f.Ep);for(const e of this.cameraTRByFrameNo.keys())e<I&&this.cameraTRByFrameNo.delete(e);this.fov===y&&this.near===v&&this.far===m||(this.fov=y,this.near=v,this.far=m,(0,d.nw)({type:u.p.UpdateCameraFOV,fov:y,near:v,far:m}))}}},27112:(e,t,a)=>{a.d(t,{R:()=>o,h:()=>n});class o{}class n{}},45554:(e,t,a)=>{a.d(t,{z:()=>f});var o=a(45799),n=a(7962),s=a(27112),i=a(85080),r=a(43584),l=a(48366),c=a(38755);const d=o.Ue(),u=n.Ue();class f extends s.h{sensitivity=25;persistent=!1;parallax=0;interpAngleX=0;interpAngleY=0;matchRotation=!0;rotationSmoothing=.8;resetSmoothing=.9;maxAngleX=70;minAngleX=-30;maxAngleY=3e3;minAngleY=-3e3;baseX=0;baseY=0;dX=0;dY=0;constructor(){super()}update(e,t,a){const{sensitivity:s}=this;let f=0,g=0,p=this.rotationSmoothing;if(i.Z.has(r.Z)){const{horizontalAngle:e,verticalAngle:t}=i.Z.get(r.Z).value;this.dX=t*s,this.dY=e*s,f=t*s,g=e*s}else this.persistent?(this.baseX+=this.dX,this.baseY+=this.dY,this.dX=0,this.dY=0):p=this.resetSmoothing;f+=this.baseX,g+=this.baseY,this.interpAngleX=(0,l.t7)(f,this.interpAngleX,p),this.interpAngleY=(0,l.t7)(g,this.interpAngleY,p),this.interpAngleX=(0,l.uZ)(this.interpAngleX,this.minAngleX,this.maxAngleX),this.persistent||(this.interpAngleY=(0,l.uZ)(this.interpAngleY,this.minAngleY,this.maxAngleY)),o.Su(d,-this.interpAngleX,this.interpAngleY,0),this.matchRotation?o.Jp(a.rotation,t.rotation,d):o.JG(a.rotation,d),this.parallax&&(n.VC(u,c._K,a.rotation),n.od(a.position,a.position,u,this.parallax))}clone(){const e=new f;return e.matchRotation=this.matchRotation,e.rotationSmoothing=this.rotationSmoothing,e.resetSmoothing=this.resetSmoothing,e.interpAngleX=this.interpAngleX,e.interpAngleY=this.interpAngleY,e.persistent=this.persistent,e.sensitivity=this.sensitivity,e.maxAngleX=this.maxAngleX,e.minAngleX=this.minAngleX,e.maxAngleY=this.maxAngleY,e.minAngleY=this.minAngleY,e.baseX=this.baseX,e.baseY=this.baseY,e.dX=this.dX,e.dY=this.dY,e}}},4751:(e,t,a)=>{a.d(t,{v:()=>u});var o=a(53393),n=a(7962),s=a(21839),i=a(27112),r=a(13008),l=a(38755);const c=n.Ue(),d=s.Ue();class u extends i.h{target;offset;constructor(e,t=n.Ue()){super(),this.target=e,this.offset=t}update(e,t,a){let i;this.target instanceof o.JH?(s.i0(c,this.target.get(r.Z).value),i=c):i=this.target,n.IH(c,this.offset,i),s.ji(d,t.position,c,l.S1),s.j6(a.rotation,d)}clone(){return new u(this.target,this.offset)}}},26831:(e,t,a)=>{a.d(t,{V:()=>d});var o=a(21839),n=a(7962),s=a(45799),i=a(53393),r=a(13008),l=a(27112),c=a(21371);class d extends l.R{target;rotation;offset;constructor(e,t,a){super(),this.target=e,this.rotation=t,this.offset=a}update(e,t){if(this.target instanceof i.JH){if(!this.target||this.target.isDestroyed())return void c.Z.Error("FixedBaseController: target entity was destroyed");o.i0(t.position,this.target.get(r.Z).value),o.j6(t.rotation,this.target.get(r.Z).value)}else n.JG(t.position,this.target),s.JG(t.rotation,this.rotation);this.offset&&n.IH(t.position,t.position,this.offset)}clone(){return new d(this.target,this.rotation)}}},52038:(e,t,a)=>{a.d(t,{R:()=>U});var o=a(21839),n=a(7962),s=a(29617),i=a(45799),r=a(27112),l=a(13008),c=a(82407),d=a(38755),u=a(48366),f=a(85080),g=a(43584),p=a(84888),Z=a(44120),h=a(5758),y=a(81308),v=a(60320);const m=o.Ue(),b=n.Ue(),w=n.Ue(),I=n.Ue(),C=n.Ue(),A=n.Ue(),k=n.Ue(),T=n.Ue(),N=n.Ue(),E=n.Ue(),M={x:0,y:0,z:0},S={x:0,y:0,z:0},D=s.Ue(),R=s.Ue(),j=s.Ue(),x=n.Ue(),P=n.Ue(),L=[];class W extends r.R{minVerticalCameraAngle=22/180*Math.PI;maxVerticalCameraAngle=16/180*Math.PI;stiffness=.0016;distance=7.5;raycastBuffer=1;minDistance=5;carPositionsByFrameNo={};cameraPositionsByFrameNo={};cameraPositionsAfterPostProcessingByFrameNo={};cameraVerticalAngleByFrameNo={};cameraLookAtPositionAfterPostProcessingByFrameNo={};historyLength=12;prevOrbit={horizontalAngle:0,verticalAngle:0};reminderOrbit={horizontalAngle:0,verticalAngle:0};isOrbitModeOn;orbit;target;constructor(e,t=!0){super(),this.orbit=t,this.target=e}update(e,t,a,r){if(!this.target||this.target.isDestroyed()||!this.target.has(l.Z))return;const W=y.Z.getMutable(v.Z).value;if(this.cameraPositionsAfterPostProcessingByFrameNo[r]){n.JG(t.position,this.cameraPositionsAfterPostProcessingByFrameNo[r]);const e=this.cameraLookAtPositionAfterPostProcessingByFrameNo[r],a=this.cameraPositionsAfterPostProcessingByFrameNo[r],o=n.Ue();return n.lu(o,e,a),n.Fv(o,o),void i.b0(t.rotation,d.S1,o)}const O=(0,c.V)(),U=this.target.get(l.Z).value;o.i0(w,U),this.carPositionsByFrameNo[r]=n.JG(L.pop()??n.Ue(),w);const G=this.carPositionsByFrameNo[r-1]??this.carPositionsByFrameNo[r];(0,d.Y_)(T,U,0),(0,d.Y_)(N,U,1),(0,d.Y_)(E,U,2),n.lu(I,w,G);const F=Math.sqrt(I[0]*I[0]+I[2]*I[2]);this.cameraPositionsByFrameNo[r-1]?n.JG(b,this.cameraPositionsByFrameNo[r-1]):o.i0(b,W),n.lu(A,b,w);const z=(0,u.bz)(O?.camera?.lowSpeedAngle,this.maxVerticalCameraAngle),J=(0,u.bz)(O?.camera?.highSpeedAngle,this.minVerticalCameraAngle),Y="number"==typeof O?.camera?.stiffness?O.camera.stiffness:this.stiffness,_=this.cameraVerticalAngleByFrameNo[r-1]??z,q=(0,u.t7)(z,J,F),H=(0,u.t7)(_,q,Y);A[1]=0,B(A,A,H),s.Fv(D,[A[0],A[2]]),s.Fv(R,[I[0],I[2]]),s.Fv(j,[T[0],T[2]]);const $=s.AK(D,R),Q=s.AK(D,j),X=$*Math.sign(Q);$>0&&n.od(A,A,T,X/10*F),n.Fv(A,A);const K=V(A,E);n.uD(A,A,d.jQ,-K*Math.max(1-F,0)*.1),n.bA(k,A,O?.camera.distance??this.distance),n.IH(t.position,w,k),this.cameraPositionsByFrameNo[r]=n.JG(L.pop()??n.Ue(),t.position);const ee=I[1];n.bA(C,I,(0,u.ii)(n.kE(I)-ee,.5,1.25)),n.bA(x,C,4),x[1]=1+3*C[1];const te=1+(1-Math.abs(A[1]))*F*1;if(n.od(x,x,N,te),n.IH(P,w,x),this.orbit&&(f.Z.has(g.Z)||this.prevOrbit.horizontalAngle||this.prevOrbit.verticalAngle)){const e=f.Z.has(g.Z)?f.Z.get(g.Z).value:null,{reminderOrbit:t}=this;e?(this.isOrbitModeOn||(t.horizontalAngle=this.prevOrbit.horizontalAngle,t.verticalAngle=this.prevOrbit.verticalAngle),this.isOrbitModeOn=!0,this.prevOrbit.horizontalAngle=e.horizontalAngle+t.horizontalAngle,this.prevOrbit.verticalAngle=e.verticalAngle+t.verticalAngle):(this.isOrbitModeOn=!1,this.prevOrbit.horizontalAngle=(0,u.t7)(this.prevOrbit.horizontalAngle,0,.1),this.prevOrbit.verticalAngle=(0,u.t7)(this.prevOrbit.verticalAngle,0,.1),this.prevOrbit.horizontalAngle=Math.abs(this.prevOrbit.horizontalAngle)<.001?0:this.prevOrbit.horizontalAngle,this.prevOrbit.verticalAngle=Math.abs(this.prevOrbit.verticalAngle)<.001?0:this.prevOrbit.verticalAngle),function(e,t,a){e!==t&&n.JG(e,t),a.verticalAngle=(0,u.uZ)(a.verticalAngle,-Math.PI/2,Math.PI/3),B(t,t,a.verticalAngle),n.uD(t,t,d.jQ,a.horizontalAngle)}(k,k,this.prevOrbit)}const ae=n.Zh(k);if(n.Fv(A,k),ae>0){const e=new p.Z.instance.Ray((0,Z.wQ)(M,w),(0,Z.wQ)(S,A)),t=h.ZP.physicsWorld.castRayAndGetNormal(e,ae+this.raycastBuffer,!0,h.jo,h.jo);t&&n.bA(k,A,t.toi*(1-this.raycastBuffer/ae))}const oe=O?.camera.minDistance??this.minDistance;n.Zh(k)<oe?(n.Fv(k,k),n.od(t.position,w,k,oe)):n.IH(t.position,w,k);const ne=this.cameraPositionsAfterPostProcessingByFrameNo[r-1]??t.position;n.t7(t.position,ne,t.position,Y);const se=this.cameraLookAtPositionAfterPostProcessingByFrameNo[r-1]??P;if(n.t7(P,se,P,Y),o.ji(m,t.position,P,d.S1),o.j6(t.rotation,m),this.cameraPositionsAfterPostProcessingByFrameNo[r]=n.JG(L.pop()??n.Ue(),t.position),this.cameraLookAtPositionAfterPostProcessingByFrameNo[r]=n.JG(L.pop()??n.Ue(),P),r%3==0)for(const e of Object.keys(this.carPositionsByFrameNo))Number(e)<r-this.historyLength&&(L.push(this.carPositionsByFrameNo[e]),delete this.carPositionsByFrameNo[e],L.push(this.cameraPositionsByFrameNo[e]),delete this.cameraPositionsByFrameNo[e],L.push(this.cameraPositionsAfterPostProcessingByFrameNo[e]),delete this.cameraPositionsAfterPostProcessingByFrameNo[e],L.push(this.cameraLookAtPositionAfterPostProcessingByFrameNo[e]),delete this.cameraLookAtPositionAfterPostProcessingByFrameNo[e],delete this.cameraVerticalAngleByFrameNo[e])}clone(){const e=new W(this.target,this.orbit);return e.minVerticalCameraAngle=this.minVerticalCameraAngle,e.maxVerticalCameraAngle=this.maxVerticalCameraAngle,e.stiffness=this.stiffness,e.distance=this.distance,e.raycastBuffer=this.raycastBuffer,e.minDistance=this.minDistance,e.prevOrbit.horizontalAngle=this.prevOrbit.horizontalAngle,e.prevOrbit.verticalAngle=this.prevOrbit.verticalAngle,e.reminderOrbit.horizontalAngle=this.reminderOrbit.horizontalAngle,e.reminderOrbit.verticalAngle=this.reminderOrbit.verticalAngle,e.target=this.target,e.orbit=this.orbit,e}}function B(e,t,a){e!==t&&n.JG(e,t),[D[0],,D[1]]=e;const o=V(e,d.b2);return n.uD(e,e,d.jQ,-o),n.jI(e,e,d.jQ,a),n.uD(e,e,d.jQ,o),e}function V(e,t){const a=O(e)*O(t),o=e[0]*t[0]+e[2]*t[2],n=0===a?0:(0,u.uZ)(o/a,-1,1),s=Math.acos(n),i=e[0]*t[2]-t[0]*e[2],r=0===a?0:(0,u.uZ)(i/a,-1,1),l=Math.asin(r);return s*Math.sign(l)}function O(e){return Math.sqrt(e[0]*e[0]+e[2]*e[2])}function U(e,t=0,a=70,o=.5,n=2e3){return{isDefault:!0,baseController:new W(e),additiveControllers:[],transitionDuration:t,fov:a,near:o,far:n}}a(4751)},79263:(e,t,a)=>{a.d(t,{x:()=>n});var o=a(26831);function n(e,t,a,n=0,s=70,i=.5,r=2e3){return{isDefault:!1,baseController:new o.V(e,t,a),additiveControllers:[],transitionDuration:n,fov:s,near:i,far:r}}},91947:(e,t,a)=>{a.d(t,{s:()=>s});var o=a(45554),n=a(26831);function s(e,t,a=0,s=70,i=.5,r=2e3){return{isDefault:!1,baseController:new n.V(e,t),additiveControllers:[new o.z],transitionDuration:a,fov:s,near:i,far:r}}},72904:(e,t,a)=>{a.d(t,{J:()=>d});var o=a(4751),n=a(21839),s=a(7962),i=a(53393),r=a(13008),l=a(27112);class c extends l.R{target;constructor(e){super(),this.target=e}update(e,t){this.target instanceof i.JH?n.i0(t.position,this.target.get(r.Z).value):s.JG(t.position,this.target)}clone(){return new c(this.target)}}function d(e,t,a,n=0,s=70,i=.5,r=2e3){return{isDefault:!1,baseController:new c(e),additiveControllers:[new o.v(t,a)],transitionDuration:n,fov:s,near:i,far:r}}},8796:(e,t,a)=>{a.d(t,{Z:()=>g});var o=a(14206),n=a.n(o),s=a(73251),i=a(70900),r=a(34586),l=a(51818),c=a(6472),d=a(86582),u=a(28876);const f=new class{collectibles=[];async getAllCollectibles(e=!0){return e?n().get(`${s.xN}/getAllCollectibles`).then((e=>{const t=e.data.filter((e=>e.enabled));this.collectibles=t||[];const a=[];return t.forEach((e=>{e.resourceIds&&a.push(...Object.values(e.resourceIds))})),(0,d.nw)({type:u.p.CollectiblesLoaded,collectibles:t}),r.Z.getResources(a).then((e=>{for(const t of e)"gltf"in t.data&&l.q.getGltf(t.data.gltf).then()})),this.collectibles})):[...this.collectibles]}addCollectibles(e){e.forEach((e=>{this.collectibles.find((t=>t.id===e.id))||this.collectibles.push(e)}))}getCollectible(e){return this.collectibles.find((t=>t.id===e))}getCollectiblesByType(e){return this.collectibles.filter((t=>t.type===e))}checkPlayerAccess(e,t){const a=this.collectibles.find((e=>e.id===t));return!(!a||a.access===i.v.Locked)&&(void 0===a.access||a.access===i.v.Free||c.Z.getAllAchievementsSync().filter((t=>e.achievements.some((e=>t.id===e.achievementId)))).some((e=>e.collectibleIds.includes(a.id))))}};f.getAllCollectibles();const g=f},39854:(e,t,a)=>{a.d(t,{_4:()=>W,cW:()=>P,jB:()=>L});var o=a(53393),n=a(7962),s=a(21839),i=a(45799),r=a(30144),l=a(34689),c=a(79276),d=a(98014),u=a(57814),f=a(13008),g=a(60320),p=a(81723),Z=a(51818),h=a(29210),y=a(25721),v=a(86582),m=a(28876),b=a(53241),w=a(85080),I=a(91331),C=a(92903),A=a(26508),k=a(79263),T=a(81308),N=a(73372),E=a(91947),M=a(52038);let S=!1,D=!0;const R=new o.AE({has:[r.Z],world:l.Z}),j=new o.AE({has:[I.Z],world:l.Z});let x;function P(){return S}function L(e){P()||(S=!0,function(){const e=w.Z.getMutable(A.Z).value,t=n.Ue(),a=e.get(g.Z).value;s.i0(t,a);const o=(0,k.x)(e,void 0,[0,2,0],.5);return C.c.addState(o),new Promise((e=>{setTimeout((()=>{e()}),550)}))}().then((()=>function(e){return D=!1,Z.q.getGltf(e.data.gltf,!0).then((e=>{x=u.Z.createEntity([g.Z,f.Z],!1);const t=w.Z.getMutable(A.Z).value,a=n.Ue(),o=t.get(g.Z).value,i=x.getMutable(g.Z).value;s.i0(a,o),s.vc(i,a);const{gameobjectDefs:r}=e,l=new Map;for(const e of r){let t=(0,d.SI)(e,!0,!0,void 0,l);if(!t){t=u.Z.createEntity([f.Z],!1),t.addWithValue(g.Z,{value:s.Iw((0,p.V)(),e.gameobjectDef.rotation,e.gameobjectDef.translation,e.gameobjectDef.scale)});const a=(0,h.fh)();t.getMutable(f.Z).sharedBuffer=a,(0,v.nw)({type:m.p.AddGameobject,objectName:e.gameobjectDef.name,localId:t.get(b.Z).value.localId,sharedWorldTransformByteOffset:a.byteOffset})}(0,y.VC)(x,t)}return(0,d.eG)(e,l),e.url}))}(e))).then((t=>async function(e,t){await async function(e){return new Promise((e=>{setTimeout(e,1e3)}))}();const a=(0,c.c)(R.collect().entities,(e=>e.get(r.Z).value.name===t.data.cameraTargetName)),o=T.Z.getMutable(g.Z).value;s.yR(o),(0,y.VC)(a,T.Z);const l=(0,E.s)(n.Ue(),i.Ue(),.2,70,.01,2e3),d=l.additiveControllers[0];d.sensitivity=20,d.maxAngleX=30,d.minAngleX=-30,d.maxAngleY=50,d.minAngleY=-50,C.c.addState(l),(0,v.nw)({type:m.p.UpdateCameraFOV,fov:70,near:.01,far:2e3}),(0,v.nw)({type:m.p.DropStarted});const{entities:u}=j.collect(),f=e=>{"camera"===e&&W()};for(const t of u){const a=t.get(I.Z).value;let o=0;for(const t of a.animationStates)t.animationGroup===e&&(++o,t.active=!0,t.startTime=void 0);o&&(a.onComplete=f)}}(t,e))))}function W(){if(D)return;D=!0;const e=T.Z.get(f.Z).value,t=s.i0(n.Ue(),e),a=s.j6(i.Ue(),e);T.Z.has(N.Z)&&(0,y.DZ)(T.Z),C.c.setState((0,k.x)(t,a));const o=w.Z.get(A.Z).value;C.c.addState((0,M.R)(o,3)),x&&u.Z.destroyEntity(x),(0,v.nw)({type:m.p.DropComplete}),S=!1}},57814:(e,t,a)=>{a.d(t,{Z:()=>N});var o=a(53393),n=a(59252),s=a(93295),i=a(53241),r=a(58183),l=a(28876),c=a(21371),d=a(42499),u=a(32429),f=a(16319),g=a(34689),p=a(85080),Z=a(5758),h=a(29210),y=a(86582),v=a(24974),m=a(91549),b=a(72366),w=a(25721),I=(a(61137),a(41465)),C=a(73372),A=a(34173),k=a(81723),T=a(12103);const N=new class{counter=0;networkedCounter=0;entities=[];entitiesByLocalId={};entitiesByNetworkId={};createEntity(e=[],t=!0,a=null){this.counter+=1;const r=new o.JH(e,g.Z);this.entities.push(r);const l=p.Z.get(n.Z).value.current,d=this.counter;if(r.addWithValue(i.Z,{value:{localId:d}}),this.entitiesByLocalId[d])throw new Error(`WorkerThread: entity with localId ${d} already exists`);if(this.entitiesByLocalId[d]=r,!t)return r;if(this.networkedCounter+=1,a=Number.isInteger(a)?a:l+1+this.networkedCounter,c.Z.Debug("networked object count -> ",this.networkedCounter),c.Z.Debug("networkId ->    ",a),r.addWithValue(s.Z,{isNetworked:!0,value:{networkId:a}}),this.entitiesByNetworkId[a])throw new Error(`WorkerThread: entity with networkId ${a} already exists`);return this.entitiesByNetworkId[a]=r,r}getEntityByLocalId(e){return this.entitiesByLocalId[e]}getEntityByNetworkId(e){return this.entitiesByNetworkId[e]}destroyComponent(e,t,a=!0){const o=e.getMutable(t);switch(t[0]){case s.Z[0]:if(a)throw new Error("WorkerThread: Cannot remove networkIdComponent");break;case i.Z[0]:if(a)throw new Error("WorkerThread: Cannot remove localIdComponent");break;case r.Z[0]:{const e=o;delete d.YJ[e.value.playerId];break}case f.Z[0]:{const e=o;Z.ZP.physicsWorld.removeRigidBody(e.value.rigidbody),e.value=void 0;break}case C.Z[0]:o.value.parent&&(0,w.DZ)(e);break;case b.Z[0]:(0,w.gu)(e,(e=>{(0,w.DZ)(e,!0),this.destroyEntity(e)}));break;case u.Z[0]:(0,m.er)();break;case v.Z[0]:break;case I.Z[0]:{const e=o;for(const t of Object.values(e.value.rings))this.destroyEntity(t);break}case A.Z[0]:{const e=o;(0,k.N)(e.value.matrix);break}case T.Z[0]:if(e.isDestroyed())break;if(e.has(r.Z)){const{playerId:t}=e.get(r.Z).value;p.Z.get(r.Z).value.playerId===t&&(0,y.nw)({type:l.p.MuralHotspotFocus,muralWallId:void 0,started:!1})}}o.sharedBuffer&&((0,h.z6)(o.sharedBuffer),o.sharedBuffer=null),a&&e.remove(t)}destroyEntity(e,t=!0){if(e.isDestroyed())return;if(t){const t=this.entities.findIndex((t=>t.id===e.id));if(t>=0){const[a]=this.entities.splice(t,1);if(a!==e)throw new Error("WorkerThread: the removed entity is not the same!")}if(e.has(i.Z)){const{localId:t}=e.get(i.Z).value;if(this.entitiesByLocalId[t]!==e)throw new Error("WorkerThread: the removed local entity is not the same!");delete this.entitiesByLocalId[t],(0,y.nw)({type:l.p.RemoveGameobject,localId:t})}if(e.has(s.Z)){const{networkId:t}=e.get(s.Z).value;if(this.entitiesByNetworkId[t]!==e)throw new Error("WorkerThread: the removed networked entity is not the same!");delete this.entitiesByNetworkId[t],this.networkedCounter--}}const a=e.getAll();for(const t of Object.getOwnPropertySymbols(a))this.destroyComponent(e,[t,null],!1);try{e.destroy()}catch(e){c.Z.Error(e)}}destroyAllEntities(){for(const e of this.entities)this.destroyEntity(e,!1);this.counter=0,this.networkedCounter=0,this.entities.length=0,this.entitiesByLocalId={},this.entitiesByNetworkId={}}}},85080:(e,t,a)=>{a.d(t,{Z:()=>g});var o=a(53393),n=a(21371),s=a(34689),i=a(59252),r=a(40137),l=a(61137),c=a(3096),d=(a(15474),a(72303)),u=a(75550);const f=new o.JH([],s.Z);f.add(i.Z),f.add(l.Z),f.add(c.Z),f.add(d.Z),f.add(r.Z),f.add(u.Z),n.Z.Information("workerThread: setupGlobalState");const g=f},51818:(e,t,a)=>{a.d(t,{q:()=>u});var o=a(46494),n=a(63805),s=a(28876),i=a(21371),r=a(89262),l=a(86582),c=a(85080),d=a(61137);const u=new class{requestPromises=new Map;requestPromiseResolvers=new Map;gltfs=new Map;objectsByName=new Map;objectsById=new Map;objectsWithState=new Array;objectsByType=new Map;setGltf(e,t){this.gltfs.set(e.url,e),t&&c.Z.getMutable(d.Z).value.childGltfs.push(e.url);const a=e=>{if(e.gameobjectDef){if(this.objectsByName.set(e.gameobjectDef.name,e),e.gameobjectDef.objectId&&this.objectsById.set(e.gameobjectDef.objectId,e),e.gameobjectDef.objectType in n.dL){const{objectType:t}=e.gameobjectDef;this.objectsByType.has(t)||this.objectsByType.set(t,[]),this.objectsByType.get(t).push(e)}e.gameobjectDef.extras?.state&&this.objectsWithState.push(e)}if(e.children)for(const t of e.children)a(t)};for(const t of e.gameobjectDefs)a(t);this.requestPromiseResolvers.has(e.url)&&(this.requestPromiseResolvers.get(e.url)(e),this.requestPromiseResolvers.delete(e.url),this.requestPromises.delete(e.url)),i.Z.Debug("Worker Thread: Gltf loaded",e.url)}async getGltf(e,t=!1){const a=(0,o.p9)(e);if(this.gltfs.has(a))return this.gltfs.get(a);if(t&&c.Z.getMutable(d.Z).value.childGltfs.push(a),this.requestPromises.has(a))return this.requestPromises.get(a);(0,l.nw)({type:s.p.GltfRequest,gltfFile:e,isPartOfLevel:t});const n=new Promise(((e,t)=>{this.requestPromiseResolvers.set(a,e)}));return n.then(),this.requestPromises.set(a,n),n}getGameobjectByName(e){return this.objectsByName.get(e)}getGameobjectById(e){return this.objectsById.get(e)}getGameobjectsByType(e){return this.objectsByType.get(e)}getGameobjectsWithState(){return this.objectsWithState}removeGltf(e){const t=this.gltfs.get(e)?.gameobjectDefs;if(!t)return void i.Z.Warning(`Trying to remove gltf ${e} but it's not in the cache`);if(c.Z.has(r.Z)){const{clips:t}=c.Z.get(r.Z).value;t[e]&&delete t[e]}const a=e=>{if(e.gameobjectDef){if(this.objectsByName.delete(e.gameobjectDef.name),e.gameobjectDef.objectId&&this.objectsById.delete(e.gameobjectDef.objectId),e.gameobjectDef.objectType in n.dL){const{objectType:t}=e.gameobjectDef;this.objectsByType.has(t)&&this.objectsByType.get(t).splice(this.objectsByType.get(t).indexOf(e),1)}e.gameobjectDef.extras?.state&&this.objectsWithState.splice(this.objectsWithState.indexOf(e),1)}if(e.children?.length)for(const t of e.children)a(t)};for(const e of t)a(e);this.gltfs.delete(e)}}},42499:(e,t,a)=>{a.d(t,{TG:()=>d,YJ:()=>c,iF:()=>u,rU:()=>f});var o=a(58183),n=a(28876),s=a(33805),i=a(21371),r=a(85080),l=a(86582);const c={};function d(){for(const e of Object.keys(c))delete c[e]}function u(e,t){return!(!e||!t)&&(e===t||e.oneFrameBoolean===t.oneFrameBoolean&&e.boolean===t.boolean&&e.joystickH===t.joystickH&&e.joystickV===t.joystickV)}function f(e,t){const a=r.Z.get(o.Z).value.playerId,f=c[a]??{};let g=!1,p=0;for(const e of Object.keys(t)){const o=t[e];for(const n of Object.keys(o))u(c[e]?.[n],t[e]?.[n])||(g=!0,+e===a&&(i.Z.Debug("server missed our input",n,c[e]?.[n],t[e]?.[n]),p++))}(0,l.nw)({type:n.p.NetworkInfo,missedInput:p}),d();for(const e of Object.keys(t)){const a=t[e];c[e]=(0,s.Q)(a)}const Z=Object.entries(f).filter((([t])=>Number(t)>e));c[a]={};for(const[e,t]of Z)c[a][e]=(0,s.Q)(t);if(t[a])for(const e of Object.keys(t[a]))c[a][e]=(0,s.Q)(t[a][e]);return g}},81308:(e,t,a)=>{a.d(t,{Y:()=>d,Z:()=>c});var o=a(53393),n=a(13008),s=a(34689),i=a(29210),r=a(60320);const l=new o.JH([r.Z,n.Z],s.Z),c=l;function d(){const e=(0,i.fh)();return l.getMutable(n.Z).sharedBuffer=e,e.byteOffset}},21113:(e,t,a)=>{a.d(t,{dm:()=>m,iq:()=>y,pQ:()=>v});var o=a(53393),n=a(56067),s=a(35416),i=a(34689),r=a(10631),l=a(57814),c=a(16319),d=a(51818),u=a(98014),f=a(43397),g=a(21371),p=a(85080),Z=a(89262);const h=new o.AE({world:i.Z,has:[r.Z]});function y(e,t){return!t||!!e.has(n.Z)&&(e.get(n.Z).value.state&t)>0}function v(e){const t=(0,s.Bi)().data.stateValues;return e.split(",").reduce(((e,a)=>{const o=t[a];return void 0===o?e:e|o}),0)}function m(){const e=(0,f.i3)();g.Z.Debug("onStateUpdate playerState: ",e);const t=new Map;for(const a of h.collect().entities){const{state:o,objectName:n}=a.get(r.Z).value;if((e&o)>0)n&&t.set(n,a);else{if(a.has(c.Z))continue;l.Z.destroyEntity(a)}}const a=d.q.getGameobjectsWithState(),{clips:o}=p.Z.get(Z.Z).value;for(const n of a){const a=n.gameobjectDef;if(0==(e&v(a.extras.state)))continue;const{name:s}=a;if(s&&t.has(s))continue;const i=new Map;(0,u.SI)(n,!1,!1,void 0,i);for(const[e,t]of Object.entries(o))for(const a of Object.values(t))for(const t of a.channels)i.has(t.targetObjectName)&&(0,u.$L)(i.get(t.targetObjectName),a,e)}}},5758:(e,t,a)=>{a.d(t,{s4:()=>d,hk:()=>f,m0:()=>Z,tK:()=>l,jo:()=>p,Xf:()=>u,_9:()=>g,bv:()=>c,pl:()=>y,ZP:()=>m,p5:()=>v});var o=a(73251),n=a(21371),s=a(84888),i=a(33768);function r({membership:e,filter:t}){let a=0;return e.forEach((e=>{a=(0,i.ft)(a,e,1)})),t.forEach((e=>{a=(0,i.ft)(a,e+16,1)})),a}const l=r({membership:[0],filter:[]}),c=r({membership:[1],filter:[2,3,4,6]}),d=r({membership:[2],filter:[1,2,3,5,7]}),u=r({membership:[3],filter:[1,2,7]}),f=r({membership:[4],filter:[1,5,7]}),g=r({membership:[5],filter:[2,4]}),p=r({membership:[6],filter:[1,7]}),Z=r({membership:[7],filter:[2,3,4,6]}),h={physicsWorld:null,eventQueue:null};async function y(){await s.Z.loadRapier,h.physicsWorld?.free();const e=new s.Z.instance.Vector3(0,-9.81,0);h.physicsWorld=new s.Z.instance.World(e),h.eventQueue=h.eventQueue||new s.Z.instance.EventQueue(!0),h.physicsWorld.timestep=o.yn,n.Z.Information("created Physics World")}function v(){h.physicsWorld?.free(),h.physicsWorld=null,n.Z.Information("destroyed Physics World")}const m=h},34586:(e,t,a)=>{a.d(t,{Z:()=>u});var o=a(14206),n=a.n(o),s=a(73251),i=a(21371),r=a(86582),l=a(28876),c=a(35416);const d=new class{resources={};async getAllResources(){try{const e=await n().get(`${s.xN}/getAllResources`),t=e.data?e.data:[];t.forEach((e=>{this.resources[e.id]=e})),(0,r.nw)({type:l.p.ResourcesLoaded,resources:t})}catch(e){i.Z.Debug(`Error fetching resources from game manager: ${e}`)}return Object.values(this.resources)}async getResources(e){const t=e.filter((e=>!this.resources[e]));if(t.length>0)try{const e=(await n().post(`${s.xN}/getResources`,t)).data;e.forEach((e=>{this.resources[e.id]=e})),(0,r.nw)({type:l.p.ResourcesLoaded,resources:e})}catch(e){i.Z.Debug(`Error fetching resources from game manager: ${e}`)}return e.map((e=>this.resources[e])).filter((e=>e))}getResourcesSync(e){return e.map((e=>this.resources[e])).filter((e=>e))}async getResource(e){if(this.resources[e])return this.resources[e];const t=await this.getResources([e]);return t[0]&&(this.resources[e]=t[0]),t[0]}getResourceSync(e){return this.resources[e]}addResources(e){e.forEach((e=>{this.resources[e.id]=e})),(0,r.nw)({type:l.p.ResourcesLoaded,resources:e})}};d.getAllResources().then((e=>{const t=e.find((e=>e.id===c.bQ));t&&(0,c.ap)(t,e)}));const u=d},29210:(e,t,a)=>{a.d(t,{XH:()=>i,fh:()=>d,z6:()=>c});var o=a(21839),n=a(1266),s=a(21371);const i={value:null};let r=0;const l={};function c(e){l[e.length]=l[e.length]||[],l[e.length].push(e)}function d(){const e=function(e){if(l[e]?.length>0)return l[e].pop();if(r+Float32Array.BYTES_PER_ELEMENT*e>i.value.byteLength)return s.Z.Error("Shared buffer length is exceeded!"),new Float32Array(e);const t=new Float32Array(i.value,r,e);return r+=Float32Array.BYTES_PER_ELEMENT*e,t}(n.P+1);return o.yR(e),e}},16520:(e,t,a)=>{a.d(t,{G:()=>n,m:()=>s});let o=a(68988).T.link;function n(e){o=e}function s(){return o}},60538:(e,t,a)=>{a.d(t,{A:()=>l,b:()=>c});var o=a(16319),n=a(4424),s=a(10562),i=a(57814);const r={x:0,y:0,z:0};function l(e){const{rigidbody:t}=e.getMutable(o.Z).value;t.setLinvel(r,!1),t.setAngvel(r,!1),e.has(n.Z)||e.add(n.Z),e.has(s.Z)||e.add(s.Z)}function c(e){e.has(n.Z)&&i.Z.destroyComponent(e,n.Z),e.has(s.Z)&&i.Z.destroyComponent(e,s.Z)}},84062:(e,t,a)=>{a.d(t,{hO:()=>T});var o=a(8430),n=a(58183),s=a(2375),i=a(23569),r=a(32429),l=a(68199),c=a(53393),d=a(13724),u=a(5473);const f=(0,c.J4)("newCar",(()=>({isNetworked:!0,sharedBuffer:null,value:{...u.v2,suspensionVelocity:d.Ue(),suspensionPosition:d.Ue()}})));var g=a(85080),p=a(26508),Z=a(16319),h=a(21371),y=a(91549),v=a(57814),m=a(59252),b=a(33805),w=a(72506),I=a(44120),C=a(92903),A=a(52038),k=a(80260);const T={},N=Symbol.keyFor(f[0]);T[N]=function(e,t){if(e.has(f)){const a=e.getMutable(f).value;(0,b.p)(a,t)}else{const a={isNetworked:!0,value:{suspensionPosition:t.suspensionPosition,suspensionVelocity:t.suspensionVelocity,maxSteerAngle:t.maxSteerAngle}};e.addWithValue(f,a)}};const E=Symbol.keyFor(l.Z[0]);T[E]=function(e,t){if(e.has(l.Z)){const a=e.getMutable(l.Z).value;(0,b.p)(a,t)}else{const a={isNetworked:!0,value:{...t}};e.addWithValue(l.Z,a)}},T[Symbol.keyFor(s.Z[0])]=function(e,t){if(e.has(s.Z)){const a=e.getMutable(s.Z).value;e.has(w.Z)||e.add(w.Z);const o=e.getMutable(w.Z).value;o.frameNo=g.Z.get(m.Z).value.current,(0,I.$2)(o.trs.translation,a.translation),(0,I.KE)(o.trs.rotation,a.rotation),(0,b.p)(a,t)}else e.addWithValue(s.Z,{isNetworked:!0,value:{bodyType:t.bodyType,colliders:t.colliders,translation:t.translation,rotation:t.rotation,linvel:t.linvel,angvel:t.angvel}});const{rigidbody:a}=e.get(Z.Z).value;if(a){a.setBodyType(t.bodyType,!1);for(let e=0;e<a.numColliders();e++){const o=a.collider(e);t.colliders[e]?(o.setSensor(t.colliders[e].isSensor),o.setCollisionGroups(t.colliders[e].collisionGroups)):h.Z.Error("Rigidbody in client doesnt have the same collider number. index:",e)}a.lockTranslations(t.isRotationLocked,!1),a.lockRotations(t.isRotationLocked,!1),a.setTranslation(t.translation,!1),a.setLinvel(t.linvel,!1),a.setAngvel(t.angvel,!1),a.setRotation(t.rotation,!0)}},T[Symbol.keyFor(n.Z[0])]=function(e,t){if(e.has(n.Z)){const a=e.getMutable(n.Z).value;(0,b.p)(a,t)}else{const a={isNetworked:!0,value:t};e.addWithValue(n.Z,a)}if(g.Z.has(n.Z)){const a=g.Z.get(n.Z).value.playerId;if(t.playerId===a){if(g.Z.has(p.Z)){if(!g.Z.get(p.Z).value.isDestroyed())return;v.Z.destroyComponent(g.Z,p.Z)}g.Z.addWithValue(p.Z,{value:e}),(0,k.Uu)()||C.c.addState((0,A.R)(e))}}},T[Symbol.keyFor(o.Z[0])]=function(e,t){if(e.has(o.Z)){const a=e.getMutable(o.Z).value;(0,b.p)(a,t)}else e.add(o.Z)},T[Symbol.keyFor(i.Z[0])]=function(e,t){const a=[];for(const e of Object.keys(t.targetTransform))a[e]=t.targetTransform[e];if(e.has(i.Z)){const a=e.getMutable(i.Z).value;(0,b.p)(a,t)}else{const o={isNetworked:!0,value:{posStiffness:t.posStiffness,rotStiffness:t.rotStiffness,targetTransform:new Float32Array(a)}};e.addWithValue(i.Z,o)}},T[Symbol.keyFor(r.Z[0])]=function(e,t){if(e.has(r.Z)){const a=e.getMutable(r.Z).value;(0,b.p)(a,t)}else{const a={isNetworked:!0,value:{targetDuration:t.targetDuration,frameOfAcquisition:t.frameOfAcquisition}};e.addWithValue(r.Z,a),(0,y.iG)(e,!0)}}},44120:(e,t,a)=>{a.d(t,{$2:()=>n,KE:()=>o,r1:()=>i,wQ:()=>s});const o=(e,t)=>(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w,e),n=(e,t)=>(e[0]=t.x,e[1]=t.y,e[2]=t.z,e),s=(e,t)=>(e.x=t[0],e.y=t[1],e.z=t[2],e),i=(e,t)=>(e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3],e)},50222:(e,t,a)=>{a.d(t,{K:()=>p,Lb:()=>Z,Se:()=>y,UA:()=>g,kK:()=>f,kt:()=>h});var o=a(7962),n=a(45799),s=a(44120);const i=o.Ue(),r=o.Ue(),l={x:0,y:0,z:0},c={x:0,y:0,z:0},d={x:0,y:0,z:0},u=n.Ue(),f=(e,t,a,n)=>{o.VC(e,t,n),o.IH(e,e,a)},g=(e,t,a)=>{o.VC(e,t,a),o.Fv(e,e)},p=(e,t,a)=>{n.U_(u,a),o.VC(e,t,u),o.Fv(e,e)},Z=(e,t,a,n,u,p)=>{g(i,p,u),o.bA(r,i,t),((e,t,a,n,l)=>{a.applyImpulseAtPoint(e,((e,t,a,n)=>(o.t8(i,t.x,t.y,t.z),f(r,i,a,n),(0,s.wQ)(e,r)))(d,t,n,l),!0)})((0,s.wQ)(l,r),(0,s.wQ)(c,e),a,n,u)},h=(e,t,a,n)=>{g(i,n,a),o.bA(r,i,e),t.applyTorqueImpulse((0,s.wQ)(l,r),!0)},y=e=>{let t=Number.MAX_VALUE,a=Number.MAX_VALUE,o=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=-Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let r=0;r<e.length;r+=3){const l=e[r],c=e[r+1],d=e[r+2];l<t&&(t=l),c<a&&(a=c),d<o&&(o=d),l>n&&(n=l),c>s&&(s=c),d>i&&(i=d)}return[.5*(n-t),.5*(s-a),.5*(i-o)]}},45687:(e,t,a)=>{function o(e){return e?(e.oneFrameBoolean=0,e):e}a.d(t,{$:()=>o})},34959:(e,t,a)=>{a.d(t,{Z:()=>x});var o,n=a(53393),s=a(7962),i=a(45799),r=a(21839),l=a(67371),c=a(34689),d=a(48366),u=a(34769),f=a(28876),g=a(86582),p=a(60320);!function(e){e[e.aceman=0]="aceman",e[e.cooper=1]="cooper",e[e.countryman=2]="countryman",e[e.NumModels=3]="NumModels"}(o||(o={}));var Z=a(89258),h=a(8796),y=a(70900),v=a(34586),m=a(51818),b=a(63805),w=a(98014),I=a(57814);const C=new n.AE({world:c.Z,has:[u.Z],trackAdded:!0,trackRemoved:!0}),A={},k=s.Ue(),T=i.Ue(),N={selected:0,animated:0},E=5,M=.05,S=1;let D=0,R=0;function j(e,t){for(;e-t>=.5*o.NumModels;)e-=o.NumModels;for(;e-t<.5*-o.NumModels;)e+=o.NumModels;return e}async function x(e,t){const a=C.collect(),n=a.added.size>0,s=a.removed.size>0;if(n||s){if(n)N.selected=0,N.animated=0,h.Z.getCollectiblesByType(y.J.car).map((e=>new Promise((t=>{const a=v.Z.getResourceSync(e.resourceIds.selection);m.q.getGltf(a.data.gltf).then((e=>{const o=m.q.getGameobjectById(a.data.objectId);o.gameobjectDef.objectType=b.dL.movable;const n=(0,w.SI)(o,!1,!1);A[a.data.index]=n,t()}))}))));else for(const e of Object.keys(A))I.Z.destroyEntity(A[e]),A[e]=void 0;(0,g.nw)({type:f.p.CarSelectEnabled,enabled:n})}if(!a.entities.size)return;t&&(R=(0,d.t7)(R,t.x*M,.1),D=(0,d.t7)(D,t.y*M,.1));const c=e.filter((e=>e.type===Z.a.selectCar));if(c.length>0){const e=h.Z.getCollectible(c[0].collectibleId),t=v.Z.getResourceSync(e.resourceIds.selection);N.selected=t.data.index,N.animated=j(N.animated,N.selected),l.p8.killTweensOf(N),l.p8.to(N,{animated:N.selected,duration:1,ease:"power1.inOut"})}for(const e of Object.keys(A)){const t=A[e],a=j(Number(e),N.animated),n=t.getMutable(p.Z).value,s=a-N.animated,l=s/o.NumModels*Math.PI*2;k[0]=0,k[1]=Math.sin(l)*E-.75,k[2]=-Math.cos(l)*E;const c=S+2*s;i.yR(T),i.lM(T,T,.5-D),i.uD(T,T,c-R),r.yl(n,T,k)}}},26626:(e,t,a)=>{a.d(t,{Z:()=>Z});var o=a(53393),n=a(26508),s=a(85080),i=a(8430),r=a(58183),l=a(24974),c=a(60531),d=a(34689),u=a(51479),f=a(92903),g=a(52038);const p=new o.AE({world:d.Z,has:[r.Z,i.Z,l.Z]});function Z(){if((0,c.LN)()||!s.Z.has(n.Z))return;const e=s.Z.getMutable(n.Z);if(!e.value.has(i.Z))return;const t=s.Z.get(r.Z).value.playerId,a=e.value.get(i.Z).value;if(a.value.c.changed&&a.value.c.value)for(const a of p.collect().entities){const{playerId:o}=a.get(r.Z).value;o!==t&&(e.value=a,s.Z.getMutable(r.Z).value.playerId=o,u.default.setLocalPlayerId(o),f.c.addState((0,g.R)(a,.5)))}}},80260:(e,t,a)=>{a.d(t,{IC:()=>K,Uu:()=>Q,ZP:()=>ee});var o=a(53393),n=a(7962),s=a(45799),i=a(21839),r=a(60320),l=a(81308),c=a(13008),d=a(53241),u=a(86582),f=a(28876),g=a(25721),p=a(48366),Z=a(43584),h=a(85080),y=a(30144),v=a(34586),m=a(51818),b=a(98014),w=a(63805),I=a(57814),C=a(57642),A=a(92903),k=a(72904),T=a(38755),N=a(91947),E=a(34689),M=a(79276),S=a(21371);let D,R,j,x=!1,P=!1;const L=n.Ue(),W=n.Ue(),B=s.Ue(),V=s.Ue(),O=-.09,U=.98;let G=0,F=0,z=.15,J=1,Y=0,_=0;const q=.05,H=n.Ue(),$=6;function Q(){return x}const X=new o.AE({has:[y.Z],world:E.Z});async function K(e,t,a){const o=e!==x,d=o||a!==P;if(x=e,e&&(P=a),o){if(!e)return A.c.clearStates(),I.Z.destroyEntity(D),te(),void(D=null);{const e=v.Z.getResourceSync(t);await m.q.getGltf(e.data.gltf,!0);const a=m.q.getGameobjectById(e.data.objectId);a.gameobjectDef.objectType=w.dL.movable,D=(0,b.SI)(a,!1,!0,C.b.carVisualizer)}}else if(!D)return;if(e&&d)if(a){const{interiorCamTarget:e,lighting:{interior:{interiorFov:a}}}=v.Z.getResourceSync(t).data;j=i.d9(l.Z.get(c.Z).value),function(e,t,a){const o=(0,M.c)(X.collect().entities,(e=>e.get(y.Z).value.name===t));let i;if(o)i=(0,N.s)(o,void 0,0,a??45,.05,500),A.c.addState(i);else{S.Z.Warning(`No target found with name ${t}`);const e=s.Ue();s.jI(e,e,.07),s.uD(e,e,.5*Math.PI),i=(0,N.s)(n.al(.8,1.2,0),e,0,45,.05,500),A.c.addState(i)}const r=i.additiveControllers[0];r.parallax=.1,r.persistent=!0}(0,e,a),i.yR(D.getMutable(r.Z).value)}else{j&&(i.JG(l.Z.getMutable(r.Z).value,j),i.JG(l.Z.getMutable(c.Z).value,j),j=null),z=.15,J=1,i.i0(W,l.Z.get(c.Z).value);const e=n.Ue(),t=l.Z.get(c.Z).value;(0,T.Y_)(e,t,2),e[1]=0,n.Fv(e,e),i.j6(V,t),n.od(L,W,e,-$);const a=D.getMutable(r.Z).value;i.vc(a,L),0,A.c.addState((0,k.J)(W,L,n.al(0,.7,0),0,45))}te()}function ee(e){x&&D&&(P||function(e){if(e&&(F=(0,p.t7)(F,e.x*q,.1),G=(0,p.t7)(G,e.y*q,.1)),h.Z.has(Z.Z)){const{horizontalAngle:e,verticalAngle:t}=h.Z.get(Z.Z).value;Y=t,_=-e}else z+=Y,J+=_,Y=0,_=0;const t=D.getMutable(r.Z).value;i.i0(L,t);const a=(0,p.uZ)(z+Y-G,O,U),o=J+_-F;s.JG(B,V),s.lM(B,B,a),s.uD(B,B,o),i.yl(t,B,L)}(e),function(){const e=[];for(const t of R){const a=t.get(c.Z).value,o=n.al(0,0,0);i.i0(o,a);const{resourceId:s}=t.get(y.Z).value;e.push({resourceId:s,translation:o})}e.length>0&&(i.i0(H,D.get(c.Z).value),(0,u.nw)({type:f.p.CarVisualizerHotspotPositions,hotspots:e,center:[H[0],H[1],H[2]]}))}())}function te(){const e=[];!function(e){if(R=[],!e)return;const t=[];(0,g.EI)(e,(e=>{if(!e.has(y.Z))return;const{type:a,resourceId:o}=e.get(y.Z).value;"carHotspot"===a&&(R.push(e),t.push(o))})),(0,u.nw)({type:f.p.CarVisualizerHotspots,resourceIds:t})}(D),(0,g.EI)(D,(t=>{t.has(d.Z)&&e.push(t.get(d.Z).value.localId)}))}},43397:(e,t,a)=>{a.d(t,{VJ:()=>Fe,JH:()=>Ye,N$:()=>fe,i3:()=>ge,J8:()=>De,J2:()=>Se,Fx:()=>Je,S6:()=>Ue,Zm:()=>Re,hN:()=>we});var o=a(53393),n=a(7962),s=a(21839),i=a(14206),r=a.n(i),l=a(3096),c=a(61371),d=a(85080),u=a(26986),f=a(58183),g=a(21371),p=a(61137),Z=a(73251),h=a(60531),y=a(16520),v=a(57814),m=a(39444),b=a(86582),w=a(28876);class I{ws;messageQueue=[];lastMessageTime=0;CONNECTING=0;OPEN=1;CLOSING=2;CLOSED=3;onclose(e){this.ws.onclose=e}onerror(e){this.ws.onerror=e}onmessage(e){this.ws.onmessage=e}onopen(e){this.ws.onopen=e}constructor(e){this.ws=new WebSocket(e)}_send(e){this.ws.send(e)}send(e){if(this.targetRTT<=0&&this.targetJitter<=0){for(let e=0;e<this.messageQueue.length;e++)this._send(this.messageQueue[e]);return this._send(e),void(this.messageQueue.length=0)}this.messageQueue.push(e);let t=this.additionalRTT+this.targetJitter*Math.random();t=Math.max(t,this.lastMessageTime-performance.now()),this.lastMessageTime=performance.now()+t,setTimeout((()=>{this.messageQueue.length&&this._send(this.messageQueue.shift())}),t)}close(){this.ws.close()}get readyState(){return this.ws.readyState}realRTT=0;targetRTT=0;targetJitter=0;additionalRTT=0;setRealRTT(e){this.realRTT=e,this.targetRTT>0&&(this.additionalRTT+=.2*(this.targetRTT-this.realRTT),this.additionalRTT<0&&(this.additionalRTT=0))}setTargetRTT(e){this.targetRTT=e,0===this.additionalRTT&&(this.additionalRTT=this.targetRTT)}setTargetJitter(e){this.targetJitter=e}}var C=a(82407),A=a(82417),k=a(89258),T=a(63805),N=a(17154),E=a(24974),M=a(18148),S=a(21150),D=a(51818),R=a(80260),j=a(95233),x=a(59252),P=a(60538),L=a(92903),W=a(52038),B=a(34586),V=a(19292),O=a(13008),U=a(72904),G=a(34689),F=a(21113),z=a(58989),J=a(56067),Y=a(8796),_=a(6472),q=a(39854);const H=new class{liveEvents=[];async getAllLiveEvents(e=!0){return e?r().get(`${Z.xN}/getAllLiveEvents`).then((e=>{const t=e.data.filter((e=>e.enabled));return this.liveEvents=t||[],(0,b.nw)({type:w.p.LiveEventsLoaded,liveEvents:t}),this.liveEvents})):[...this.liveEvents]}addLiveEvents(e){e.forEach((e=>{this.liveEvents.find((t=>t.id===e.id))||this.liveEvents.push(e)}))}getLiveEvent(e){return this.liveEvents.find((t=>t.id===e))}};H.getAllLiveEvents();const $=H;var Q=a(98014),X=a(35416),K=a(79517),ee=a(45554),te=a(45799),ae=a(27112),oe=a(52782),ne=a(81308);const se=n.Ue(),ie=te.Ue();class re extends ae.R{speed=200;shiftMultiplier=2;constructor(){super()}update(e,t,a,o){if(!d.Z.has(oe.P))return;const i=ne.Z.get(O.Z).value;s.j6(ie,i),s.i0(t.position,i);const r=d.Z.get(oe.P).value;let l=0,c=0;r.Shift&&(e*=this.shiftMultiplier),r.w?c=-this.speed:r.s&&(c=this.speed),r.a?l=-this.speed:r.d&&(l=this.speed),n.t8(se,l*e,0,c*e),n.VC(se,se,ie),n.IH(t.position,t.position,se)}clone(){return new re}}function le(e=0,t=70,a=.5,o=2e3){const n=new ee.z;return n.persistent=!0,n.matchRotation=!1,n.minAngleY=Number.NEGATIVE_INFINITY,n.maxAngleY=Number.POSITIVE_INFINITY,n.minAngleX=-90,n.maxAngleX=90,{isDefault:!1,baseController:new re,additiveControllers:[n],transitionDuration:e,fov:t,near:a,far:o}}let ce,de=!1;const ue={playerId:Math.ceil(1e6*Math.random()),playerName:"player",seen:0,state:16,achievements:[],selectedCar:"",selectedParticle:"",selectedParticleColor:""};function fe(){return ue}function ge(){return ue.state}let pe=null,Ze=!1,he=!1;const ye=[],ve=new o.AE({world:G.Z,has:[f.Z,A.Z]}),me=new o.AE({world:G.Z,has:[f.Z,E.Z]}),be=new o.AE({has:[V.Z,O.Z],world:G.Z});function we(e){return!((0,h.d_)()||!ce||ce.readyState!==ce.OPEN||(ye.push(e),0))}let Ie=0;let Ce=null;const Ae=.1,ke=.1;let Te=null,Ne=null,Ee=0;function Me(e){clearTimeout(Ce),Ce=null;const t=performance.now()-e.pingTime;if(null!==Ne){const e=Math.max(Ae*t+(1-Ae)*Ne,0);Te=e,Ee=function(e,t){const a=Math.abs(e-t);return Ee=ke*a+(1-ke)*Ee,Ee}(e,Ne),ce.setRealRTT(e),Ne=e}else Ne=t;(0,b.nw)({type:w.p.NetworkInfo,ping:Te,jitter:Ee})}function Se(){return Te}function De(){return Ee}async function Re(e,t){const a=`${Z.xN}/player/register`;try{const o=await r().post(a,{playerId:1===e?Math.ceil(1e6*Math.random()):e,playerName:t});if(o.data){const e=o.data;for(const[t,a]of Object.entries(e))ue[t]=a;return ue}}catch(e){g.Z.Error("Error while registering player name",e)}return null}function je(){g.Z.Debug("connected to the server."),function(){g.Z.Debug("register called"),Ze=!1,he=!1,clearTimeout(Ce),Ce=null,Ie=0;const{playerId:e}=d.Z.get(f.Z).value;we({type:u.P.PlayerRegistration,playerId:e})}()}function xe(){g.Z.Debug("disconnected from the server."),ye.length=0,Ze=!1,he=!1,clearTimeout(Ce),Ce=null,Ie=0,de&&setTimeout((()=>{ze()}),5e3)}function Pe(){Ze&&!he&&(he=!0,we({type:u.P.PlayerSpawnRequest,spawnType:(0,y.m)(),carCollectibleId:ue.selectedCar}),g.Z.Debug("requested to spawn with car id",ue.selectedCar))}function Le({playerProfile:e}){(0,b.nw)({type:w.p.SetPlayerProfile,playerProfile:e});for(const[t,a]of Object.entries(e))ue[t]=a;Ze=!0,clearTimeout(Ce),Ce=null,Ie=0,Pe()}function We({responseType:e}){e===u.x.BadWording?(0,b.nw)({type:w.p.ChatSetBadWording,badWording:!0}):(0,b.nw)({type:w.p.ChatSetBadWording,badWording:!1})}function Be({textures:e}){(0,b.nw)({type:w.p.MuralTextureUpdate,textures:e})}function Ve({status:e,progress:t,images:a}){e===m.A.Ready?(0,b.nw)({type:w.p.SetGeneratedImages,images:a}):e===m.A.Processing?(0,b.nw)({type:w.p.SetGenerationProgress,progress:t}):(0,b.nw)({type:w.p.SetGenerationStatus,status:e})}function Oe({status:e,muralId:t}){(0,b.nw)({type:w.p.SetSubmissionStatus,status:e,muralId:t})}function Ue(e){const t=me.collect().entities;for(const a of e.actions)switch(a.type){case k.a.chat:{g.Z.Debug("got a new chat message! -> ",a.chat);const t={x:80*Math.random()+10,y:80*Math.random()+10};(0,b.nw)({type:w.p.ShowChat,playerId:e.playerId,chat:a.chat,position:t});const o=d.Z.get(f.Z).value.playerId;e.playerId===o&&(0,b.nw)({type:w.p.CloseChat});break}case k.a.selectCar:{for(const o of t){const{playerId:t}=o.get(f.Z).value;if(t===e.playerId){o.addWithValue(j.Z,{isNetworked:!0,value:{frameNo:a.frameNo??d.Z.get(x.Z).value.target,collectibleId:a.collectibleId}});break}}const o=d.Z.get(f.Z).value.playerId;e.playerId===o&&(ue.selectedCar=a.collectibleId);break}case k.a.carEffectSprite:{const t=ve.collect().entities;for(const o of t)if(o.get(f.Z).value.playerId===e.playerId){const{value:t}=o.getMutable(A.Z);void 0!==a.particleCollectibleId&&(t.particleCollectibleId=a.particleCollectibleId),void 0!==a.colorCollectibleId&&(t.colorCollectibleId=a.colorCollectibleId);const n=d.Z.get(f.Z).value.playerId;e.playerId===n&&(0,b.nw)({type:w.p.SetParticleEffect,particleId:t.particleCollectibleId,colorId:t.colorCollectibleId});break}break}case k.a.sendEmoji:for(const o of t)if(o.get(f.Z).value.playerId===e.playerId){const e=(0,N.K)(a.emoji),t=D.q.getGameobjectsByType(T.dL.emoji).find((t=>t.gameobjectDef.extras.emoji===e))?.gameobjectDef;if(!t)return;const n=Date.now();for(let e=0;e<Z.kp;e++){const a={timeAdded:n,spawnIndex:e,sourceEntity:o,initRotation:Math.random()*Math.PI*2,initPhase:Math.random()*Math.PI*2};(0,S.t)(t,M.Z,a)}break}break;case k.a.toggleCarVisualizer:if(e.playerId===ue.playerId&&(0,R.IC)(a.isActive,a.resourceId,a.interior),a.isActive)break;for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.b)(a);break}break;case k.a.stopDropSequence:for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.b)(a);break}(0,q._4)();break;case k.a.enterOledView:{const[e]=be.collect().entities,{resourceId:t}=e.get(V.Z).value;B.Z.getResource(t).then((t=>{const a=e.get(O.Z).value,o=t.data.cameraOffset,i=n.Ue(),r=s.Ue();s.vc(r,o),s.Jp(r,a,r),s.i0(i,r),L.c.addState((0,U.J)(i,e,void 0,.5))}));break}case k.a.leaveOledTrigger:for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.b)(a),e.playerId===ue.playerId&&L.c.addState((0,W.R)(a,.25));break}break;case k.a.leaveCarVisualizerTrigger:case k.a.leaveDropTrigger:break;case k.a.startDropSequence:for(const o of t)if(o.get(f.Z).value.playerId===e.playerId){if((0,P.A)(o),e.playerId===ue.playerId){const e=B.Z.getResourceSync(a.resourceId);(0,q.jB)(e)}break}break;case k.a.dropAnimationComplete:for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.b)(a);break}break;case k.a.startCarVisualizer:for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.A)(a);break}break;case k.a.endCarVisualizer:(0,h.d_)()&&("car_visualizer_j01"===a.resourceId?ue.achievements.push({achievementId:K.I.visualizer_j01,achievedOn:new Date}):"car_visualizer_u25"===a.resourceId&&ue.achievements.push({achievementId:K.I.visualizer_u25,achievedOn:new Date}),(0,b.nw)({type:w.p.SetPlayerProfile,playerProfile:ue}));break;case k.a.viewBlockIsRemoved:Pe();break;case k.a.switchToFlyMode:L.c.addState(le());break;case k.a.lockCar:for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.A)(a);break}break;case k.a.unlockCar:for(const a of t)if(a.get(f.Z).value.playerId===e.playerId){(0,P.b)(a);break}}}function Ge(e){let t;try{t=JSON.parse(e.data)}catch(e){return}for(let e=0;e<t.length;e++){const n=t[e];switch(n.type){case u.P.Pong:Me(n);break;case u.P.UserInputBundle:o=n.playerInputs,d.Z.getMutable(l.Z).value.push(...o);break;case u.P.Snaphot:a=n,d.Z.has(c.Z)&&v.Z.destroyComponent(d.Z,c.Z),d.Z.addWithValue(c.Z,{value:a});break;case u.P.PlayerRegistrationConfirmation:Le(n);break;case u.P.ChatResponse:We(n);break;case u.P.MuralTextureUpdate:g.Z.Debug("MuralTextureUpdate",n),Be(n);break;case u.P.MuralGenerationStatus:g.Z.Debug("MuralGenerationStatus",n),Ve(n);break;case u.P.MuralSubmissionStatus:g.Z.Debug("MuralSubmissionStatus",n),Oe(n);break;case u.P.PlayerActions:Ue(n);break;case u.P.ResourcesUpdated:B.Z.getAllResources();break;case u.P.CollectiblesUpdated:Y.Z.getAllCollectibles(!0);break;case u.P.AchievementsUpdated:_.Z.getAllAchievements(!0);break;case u.P.LiveEventsUpdated:$.getAllLiveEvents(!0);break;case u.P.PlayerProfileUpdate:{const{playerProfile:e}=n;for(const t of me.collect().entities)if(t.get(f.Z).value.playerId===e.playerId){t.has(z.Z)?t.getMutable(z.Z).value.playerName=e.playerName:t.addWithValue(z.Z,{isNetworked:!0,value:{playerName:e.playerName}}),t.has(J.Z)?t.getMutable(J.Z).value.state=e.state:t.addWithValue(J.Z,{isNetworked:!0,value:{state:e.state}});break}if(ue.playerId===e.playerId){for(const[t,a]of Object.entries(e))ue[t]=a;(0,F.dm)()}(0,b.nw)({type:w.p.SetPlayerProfile,playerProfile:e});break}default:g.Z.Error("We got an unknown message!",n)}}var a,o}function Fe(){ce?.close(),de=!1}async function ze(e,t=!1){if((0,h.d_)())return;if(de=!0,Ie=0,e&&await new Promise((t=>setTimeout((()=>{t()}),e))),!t&&(ce?.readyState===WebSocket.OPEN||ce?.readyState===WebSocket.CONNECTING))return;ce?.close();const a=d.Z.get(p.Z).value.current.data;if(null===a.index)return void g.Z.Warning("Current level is null! Cant connect to the server without knowing the level.");const o=`${Z.xN}/getServer?g=${a.index}`;let n=0;try{const e=await(await fetch(o)).json();if(!e.ok)return void ze(5e3);if(a.index!==e.g){g.Z.Warning(`We are redirected to the level ${e.g} instead of ${a.index}`);const t=X.gr.get(e.g);return void(0,Q.WO)(t.data.name)}n=e.i}catch(e){return void ze(5e3)}const s=`wss://${"physics-{levelIndex}.miniverse.dmdr.io".replace("{levelIndex}",`${a.index}`)}/${n}?v=${Z.Cx}`;ce=new I(s),pe=a.index,ce.onopen(je),ce.onmessage(Ge),ce.onclose(xe)}function Je(e){pe!==e&&ze(0,!0)}function Ye(){if(!(0,h.d_)()){if(ce){const e=(0,C.V)();ce.setTargetRTT(e.ping),ce.setTargetJitter(e.jitter)}!function(e){if(e-Ie>10&&(Ie=e,Ze&&we({type:u.P.Ping,pingTime:performance.now()})&&(clearTimeout(Ce),Ce=setTimeout((()=>{Ce&&(g.Z.Warning("The server didnt respond in time. Disconnecting.."),ce.close(),clearTimeout(Ce),Ce=null)}),Z.BC))),ye.length&&ce&&ce.readyState===ce.OPEN){const e=JSON.stringify(ye);ce.send(e),ye.length=0}}(d.Z.get(x.Z).value.current)}}},91190:(e,t,a)=>{a.d(t,{Z:()=>v});var o=a(53393),n=a(7962),s=a(21839),i=a(21371),r=a(73251),l=a(34689),c=a(85080),d=a(24974),u=a(32429),f=a(59252),g=a(60320),p=a(86904);const Z=new o.AE({world:l.Z,has:[d.Z,u.Z]}),h=new o.AE({world:l.Z,has:[p.Z,g.Z]}),y=n.Ue();function v(){const[e]=h.collect().entities;if(!e)return;const t=e.getMutable(g.Z).value;s.uD(t,t,2*r.yn);const{entities:a}=Z.collect();if(!a.size)return;a.size>1&&i.Z.Error(`workerThread: MAYDAY MAYDAY! there are ${a.size} cars in the level with the crown! We expect to have only one at a time!`);const o=c.Z.get(f.Z).value.current;for(const e of a){const{frameOfAcquisition:a,targetDuration:n}=e.get(u.Z).value,i=(o-a)*r.yn,l=Math.max(i/n*.6,.1)/s.Q$(y,t)[0];s.bA(t,t,[l,l,l])}}},95290:(e,t,a)=>{a.d(t,{d:()=>N});var o=a(53393),n=a(7962),s=a(45799),i=a(21839),r=a(34689),l=a(13008),c=a(57814),d=a(67991),u=a(18148),f=a(60320);const g=n.al(0,1,0),p=new o.AE({world:r.Z,has:[u.Z,f.Z]}),Z=10,h=.2,y=3,v=1,m=n.al(0,.3,0),b=n.al(0,.6,0),w=1,I=.5,C=.2,A=n.Ue(),k=n.Ue(),T=s.Ue();function N(){const e=Date.now()/1e3;for(const t of p.collect().entities){if(t.isDestroyed())continue;const a=t.getMutable(u.Z).value,o=t.getMutable(f.Z).value,r=e-(a.timeAdded/1e3+a.spawnIndex/Z);if(r>y||!a.sourceEntity||a.sourceEntity.isDestroyed()){c.Z.destroyEntity(t);continue}if(r<0)continue;const p=a.sourceEntity.get(l.Z).value;r>=0&&!a.origin&&(a.origin=i.i0(n.Ue(),p),a.origin[0]+=(2*Math.random()-1)*h,a.origin[2]+=(2*Math.random()-1)*h),n.IH(A,a.origin,b);const N=(0,d.C)(y,.5*y,r)*(0,d.C)(0,.1*y,r),E=r*I*N,M=r*C+a.initPhase;A[0]+=Math.cos(M)*E,A[1]+=.5*v*r*r,A[2]+=Math.sin(M)*E,n.od(A,A,m,r),s.yY(T,g,w*r+a.initRotation),n.t8(k,N,N,N),i.Iw(o,T,A,k)}}},27405:(e,t,a)=>{a.d(t,{s:()=>y});var o=a(85080),n=a(58183),s=a(42499),i=a(26986),r=a(43397),l=a(26508),c=a(73251),d=a(60531),u=a(33805),f=a(45687),g=a(86582),p=a(28876),Z=a(59252),h=a(21371);function y(e){if(!o.Z.has(n.Z)||!o.Z.has(l.Z))return;const{playerId:t}=o.Z.get(n.Z).value;s.YJ[t]=s.YJ[t]||{};const a=o.Z.get(Z.Z).value,y=Math.ceil((0,r.J2)()/c.Ep),v=Math.max(y-a.diffWithServer+c.E_,c.dX),m=a.target+((0,d.LN)()?v:0);if((0,g.nw)({type:p.p.NetworkInfo,inputLatency:v}),(0,d.LN)()&&s.YJ[t][m])return;const b=[];let w=null;for(let e=m-1;e>=0;e--){if(s.YJ[t][e]){w=s.YJ[t][e];break}b.push(e)}w=(0,f.$)((0,u.Q)(w));const I=(0,u.Q)(e);s.YJ[t][m]=I,(0,s.iF)(w,I)||((0,d.LN)()&&h.Z.Debug("sending input",m,I),function(e,t,a){const o={type:i.P.PlayerFrameInput,frameNo:t,playerId:a,input:e};(0,r.hN)(o)}(I,m,t))}},16317:(e,t,a)=>{a.d(t,{Z:()=>u});var o=a(53393),n=a(34689),s=a(58989),i=a(86582),r=a(28876),l=a(53241),c=a(58183);const d=new o.AE({world:n.Z,has:[l.Z,c.Z,s.Z],trackAdded:!0});function u(){for(const e of d.collect().added){const{playerId:t}=e.get(c.Z).value,{localId:a}=e.get(l.Z).value,{playerName:o}=e.get(s.Z).value;(0,i._o)({type:r.p.SetPlayerInfo,localId:a,playerId:t,playerName:o})}}},75124:(e,t,a)=>{a.d(t,{Z:()=>c});var o=a(85080),n=a(43397),s=a(26986),i=a(59252),r=a(58183),l=a(60531);function c(e){const t=(0,l.d_)(),a=e.filter((e=>e.isLocal||t));if(!a.length||!o.Z.has(r.Z)||!o.Z.has(i.Z))return;const c={type:s.P.PlayerActions,frameNo:o.Z.getMutable(i.Z).value.current,playerId:o.Z.get(r.Z).value.playerId,actions:a};(0,n.S6)(c)}},12045:(e,t,a)=>{a.d(t,{Z:()=>Z});var o=a(53393),n=a(86582),s=a(28876),i=a(30144),r=a(34689),l=a(75550),c=a(85080),d=a(53241),u=a(29210),f=a(13008);const g=["spikeTop1","spikeMouth1","spikeMouthDrop","spikeEcoMouth01","spikeEcoMouth02","spikeEcoMouth03"],p=new o.AE({world:r.Z,has:[i.Z],trackAdded:!0});function Z(){const e=c.Z.get(l.Z).value;if(e.spikeOuter||e.spikeInner||e.spikeOuterDrop||e.spikeInnerDrop||e.spikeEcoOuter01||e.spikeEcoInner01||e.spikeEcoOuter02||e.spikeEcoInner02||e.spikeEcoOuter03||e.spikeEcoInner03)for(const e of p.collect().added){const t=e.get(i.Z).value.name;if(g.includes(t)){const{localId:a}=e.get(d.Z).value,o=(0,u.fh)();e.getMutable(f.Z).sharedBuffer=o,(0,n.nw)({type:s.p.AddGameobject,localId:a,sharedWorldTransformByteOffset:o.byteOffset}),(0,n._o)({type:s.p.SpikeTargetAdded,localId:a,targetName:t})}}}},91854:(e,t,a)=>{a.d(t,{y:()=>u});var o=a(53393),n=a(34689),s=a(89262),i=a(84169),r=a(75224),l=a(91331),c=a(85080);const d=new o.AE({world:n.Z,has:[l.Z]});function u(){const{clips:e}=c.Z.get(s.Z).value,t=performance.now();for(const a of d.collect().entities)f(e,a,t)}function f(e,t,a){if(t.isDestroyed())return;const o=t.getMutable(l.Z).value,{animationStates:n,onComplete:s}=o;for(const l of n){if(!l.active)continue;const n=e[l.animationGroup][l.clipName];if(!n)continue;const c=n.duration*(n.pingpong?2:1);l.startTime||(l.startTime=a);let d=(a-l.startTime)/1e3;n.loop&&(d%=c),d>c?(l.active=!1,s?.(l.clipLabel)):o.isComplete=!1;const u=n.duration-Math.abs(d-n.duration);n.channels.forEach(((e,a)=>{!t.isDestroyed()&&t.has(i.Z)&&r.O.apply(t.getMutable(i.Z).value,e,u)}))}}},74165:(e,t,a)=>{a.d(t,{j:()=>W});var o=a(53393),n=a(7962),s=a(21839),i=a(45799),r=a(34689),l=a(48366),c=a(67991),d=a(57814),u=a(21150),f=a(13008),g=a(60320),p=a(89649),Z=a(34173),h=a(34586),y=a(8796),v=a(51818),m=a(81723);const b=new o.AE({world:r.Z,has:[Z.Z,g.Z]}),w=new o.AE({world:r.Z,has:[p.Z],trackAdded:!0,trackRemoved:!0,trackMutated:[p.Z]}),I=20,C=n.al(0,0,1),A=5,k=3,T=n.al(0,0,5),N=n.al(0,-.25,1),E=3,M=4,S=s.Ue();s.aC(S,-.5);const D=n.Ue(),R=n.Ue(),j=i.Ue();function x(e,t){e.respawned=!1,e.matrix=e.matrix??(0,m.V)(),s.Jp(e.matrix,t,S),s.Iu(e.matrix,e.matrix,N)}async function P(e,t){const{particleCollectibleId:a,colorCollectibleId:o}=e.get(p.Z).value,n=y.Z.getCollectible(a).resourceIds.particle,s=(await h.Z.getResources([n]))?.[0],i=y.Z.getCollectible(o).resourceIds.color,r=(await h.Z.getResources([i]))?.[0];if(!s||!r)return;if(!s)return;const l=(await v.q.getGltf(s.data.gltf)).gameobjectDefs,c=l.find((e=>e.gameobjectDef.extras.particleType===`${s.data.particleType}_${r.data.particleType}`))?.gameobjectDef;if(c)for(let a=0;a<I;++a){const o={timeAdded:1e3*t,spawnIndex:a,sourceEntity:e,initRotation:Math.random()*Math.PI*2,initPhase:Math.random()*Math.PI*2,radius:4*Math.random(),respawned:!0};(0,u.t)(c,Z.Z,o)}}function L(e,t){for(const a of e){const e=a.get(Z.Z).value;e.sourceEntity===t&&(e.dying=!0)}}function W(){const e=performance.now()/1e3,t=b.collect().entities,{added:a,removed:o,mutated:r}=w.collect();for(const t of a)P(t,e);for(const e of o)L(t,e);for(const a of r)L(t,a),P(a,e);for(const a of t){if(a.isDestroyed())continue;const t=a.get(Z.Z).value,o=a.getMutable(g.Z).value;let r=e-(t.timeAdded/1e3+t.spawnIndex/A);if(t.dying&&(r<0||r>k)){d.Z.destroyEntity(a);continue}if(r>k){const e=Math.floor(r/k)*k;t.respawned=!0,t.timeAdded+=1e3*e,r-=e}if(t.respawned){if(!(r>=0))continue;{if(!t.sourceEntity||t.sourceEntity.isDestroyed()){d.Z.destroyEntity(a);continue}const e=t.sourceEntity.get(f.Z).value;x(t,e)}}const u=(0,c.C)(k,0,r)*(0,c.C)(0,.05*k,r);n.t8(R,u,u,u);const p=r/k,h=(0,l.t7)(.25*t.radius,t.radius,p),y=r*M+t.initPhase;n.t8(D,Math.cos(y)*h,Math.sin(y)*h,0),n.od(D,D,T,r),i.yY(j,C,E*r+t.initRotation),s.Iw(o,j,D,R),s.Jp(o,t.matrix,o)}}},27757:(e,t,a)=>{a.d(t,{t:()=>N});var o=a(53393),n=a(45799),s=a(7962),i=a(21839),r=a(25721),l=a(34689),c=a(60320),d=a(13008),u=a(72366),f=a(73372),g=a(42748),p=a(73251);const Z=n.yR(n.Ue()),h=s.al(0,0,0),y=n.Ue(),v=s.Ue(),m=s.Ue(),b=i.Ue();function w(e,t){const a=t.get(c.Z).value;if(!t.has(g.Z))return i.JG(e,a),e;const o=t.getMutable(g.Z).value;return n.ZA(o.rotation,o.rotation,Z,p.sH),s.t7(o.translation,o.translation,h,p.sH),s.t7(o.scale,o.scale,h,p.sH),i.j6(y,a),i.i0(v,a),i.Q$(m,a),n.Jp(y,y,o.rotation),s.$X(v,v,o.translation),s.$X(m,m,o.scale),i.Iw(e,y,v,m),e}function I(e,t){const a=e.getMutable(d.Z).value;w(b,e),i.dC(a,t,b)}const C=new o.AE({world:l.Z,has:[c.Z,d.Z],trackAdded:!0,trackMutated:[c.Z]}),A=new o.AE({world:l.Z,has:[d.Z,u.Z],trackAdded:!0,trackMutated:[u.Z,d.Z]});function k(e){if(e.has(f.Z)){const{parent:t}=e.get(f.Z).value;!t?.isDestroyed()&&t.has(d.Z)&&I(e,t.get(d.Z).value)}else w(b,e),i.JG(e.getMutable(d.Z).value,b)}function T(e){(0,r.EI)(e,((e,t)=>{I(e,t.get(d.Z).value)}))}function N(){const e=C.collect();for(const t of e.added)k(t);for(const t of e.mutated)k(t);const t=A.collect();for(const e of t.added)e.isDestroyed()||T(e);for(const e of t.mutated)e.isDestroyed()||T(e)}},70149:(e,t,a)=>{a.d(t,{Z:()=>h});var o=a(53393),n=a(7962),s=a(21839),i=a(73251),r=a(48366),l=a(60320),c=a(34689),d=a(17803);const u=new o.AE({world:c.Z,has:[d.Z,l.Z],trackAdded:!0}),f=n.Ue(),g=n.Ue(),p=n.Ue(),Z=n.Ue();function h(){const e=u.collect();for(const t of e.added){const{originalTranslation:e}=t.get(d.Z).value,a=t.get(l.Z).value;s.i0(e,a)}for(const t of e.entities){if(t.isDestroyed())continue;const e=t.getMutable(d.Z).value,{axis:a,speed:o,distance:c,t:u,direction:h,originalTranslation:y}=e;let v=u+o*i.yn*(h?1:-1);h&&v>=1?e.direction=!1:!h&&v<=-1&&(e.direction=!0),v=(0,r.uZ)(v,-1,1),e.t=v;const m=t.getMutable(l.Z).value,b=(1-(1-Math.abs(v))**1.6)*Math.sign(v);n.bA(f,a,c*b),n.IH(p,y,f),s.i0(g,m),n.lu(Z,p,g),s.Iu(m,m,Z)}}},97746:(e,t,a)=>{a.d(t,{Z:()=>m});var o=a(53393),n=a(45799),s=a(7962),i=a(21839),r=a(34689),l=a(80523),c=a(60320),d=a(72366),u=a(2934);const f=new o.AE({world:r.Z,has:[l.Z]}),g=n.Ue(),p=n.Ue(),Z=s.Ue(),h=s.al(1,0,0),y=s.al(0,1,0),v=new Map;function m(){for(const e of f.collect().entities){const t=e.get(l.Z).value,a=e.getMutable(c.Z).value,o=t.type===u.g.FRONT_LEFT||t.type===u.g.FRONT_RIGHT;n.yY(g,y,(o?-t.angle:0)+(Math.sign(t.offset[0])>0?Math.PI:0)),n.Fv(g,g);const[r]=e.get(d.Z).value,f=r.getMutable(c.Z).value,m=t.type===u.g.BACK_LEFT||t.type===u.g.FRONT_LEFT?1:-1,b=(v.get(r)||0)+.03*t.speed*m;v.set(r,b),n.yY(p,h,b),n.Fv(p,p),i.en(f,p),s.t8(Z,t.offset[0],t.distance,t.offset[2]),i.yl(a,g,Z)}}},91549:(e,t,a)=>{a.d(t,{ZP:()=>E,er:()=>N,iG:()=>T});var o=a(53393),n=a(21839),s=a(24974),i=a(32429),r=a(22857),l=a(22971),c=a(16319),d=a(5758),u=a(73251),f=a(21371),g=a(86582),p=a(28876),Z=a(34689),h=a(57814),y=a(86904),v=a(25721),m=a(60320),b=a(13008),w=a(85080),I=a(58183);const C=new o.AE({world:Z.Z,has:[s.Z,i.Z]}),A=new o.AE({world:Z.Z,has:[l.Z,r.Z,c.Z]}),k=new o.AE({world:Z.Z,has:[y.Z]});function T(e,t=!1){const[a]=k.collect().entities;(0,v.VC)(e,a);const o=a.getMutable(m.Z).value;n.vc(o,[0,2,0]);const s=w.Z.get(I.Z).value.playerId,r=e.get(I.Z).value.playerId;t||s!==r||(0,g.nw)({type:p.p.AttachCrown,duration:e.get(i.Z).value.targetDuration})}function N(){const[e]=A.collect().entities;if(!e)return;const{rigidbody:t}=e.getMutable(c.Z).value;if(t){t.collider(0).setCollisionGroups(d._9),e.getMutable(r.Z).value.taken=!1;{const[t]=k.collect().entities;(0,v.DZ)(t);const a=e.get(b.Z).value,o=t.getMutable(m.Z).value;n.JG(o,a)}}}function E(e){const[t]=A.collect().entities;if(!t)return;const{entities:a}=C.collect();if(!a.size)return;a.size>1&&f.Z.Error(`workerThread: MAYDAY MAYDAY! there are ${a.size} cars in the level with the crown! We expect to have only one at a time!`);const{targetDuration:o}=t.get(r.Z).value,[n]=a,{frameOfAcquisition:s}=n.get(i.Z).value;(e-s)*u.yn>=o&&(f.Z.Debug("Someone won the crown reward!!!"),h.Z.destroyComponent(n,i.Z),w.Z.get(I.Z).value.playerId===n.get(I.Z).value.playerId&&(0,g.nw)({type:p.p.DetachCrown}))}},20081:(e,t,a)=>{a.d(t,{Nt:()=>Be,v8:()=>Oe,OM:()=>Fe,Q4:()=>Le});var o,n=a(21839),s=a(7962),i=a(45799),r=a(63805),l=a(84888),c=a(5758),d=a(50222),u=a(21371);!function(e){e[e.CUBOID=0]="CUBOID",e[e.ROUND_CUBOID=1]="ROUND_CUBOID",e[e.TRIMESH=2]="TRIMESH",e[e.HULL=3]="HULL",e[e.SPHERE=4]="SPHERE"}(o||(o={}));const f=(e,t,a,n,s=[0,0,0],i=[0,0,0,1],d=[1,1,1])=>{const f=(t?l.Z.instance.RigidBodyDesc.fixed():l.Z.instance.RigidBodyDesc.dynamic()).setTranslation(s[0],s[1],s[2]).setRotation({x:i[0],y:i[1],z:i[2],w:i[3]}).setCanSleep(!0).setAngularDamping(.2).setLinearDamping(.2).setCcdEnabled(!1).setUserData({objectType:t?r.dL.static:r.dL.dynamic}),g=e.createRigidBody(f);if(!a||!n)return u.Z.Warning("Object doesnt have a mesh attached. Remove the collider: mesh from the object"),null;let p=a;1===d[0]&&1===d[1]&&1===d[2]||(p=a.map(((e,t)=>e*d[t%3])));const Z=l.Z.instance.ColliderDesc.trimesh(p,n).setMass(.2).setFriction(1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Multiply).setRestitution(0).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(t?c.bv:c.s4).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setActiveEvents(l.Z.instance.ActiveEvents.COLLISION_EVENTS);return{collider:e.createCollider(Z,g),rigidbody:g,dynamic:!t,shape:o.TRIMESH,initPos:s,initRot:i,initScale:d,vertices:a,indices:n}},g=(e,t,a,n=[0,0,0],s=[0,0,0,1],i=[1,1,1])=>{const d=(t?l.Z.instance.RigidBodyDesc.fixed():l.Z.instance.RigidBodyDesc.dynamic()).setTranslation(n[0],n[1],n[2]).setRotation({x:s[0],y:s[1],z:s[2],w:s[3]}).setCanSleep(!0).setAngularDamping(.2).setLinearDamping(.2).setCcdEnabled(!1).setUserData({objectType:t?r.dL.static:r.dL.dynamic});let u=a;1===i[0]&&1===i[1]&&1===i[2]||(u=a.map(((e,t)=>e*i[t%3])));const f=e.createRigidBody(d),g=l.Z.instance.ColliderDesc.convexHull(u).setMass(.2).setFriction(1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Multiply).setRestitution(.2).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(t?c.bv:c.s4).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setActiveEvents(l.Z.instance.ActiveEvents.COLLISION_EVENTS);return e.createCollider(g,f),{collider:e.createCollider(g,f),rigidbody:f,vertices:a,dynamic:!t,shape:o.HULL,initPos:n,initRot:s,initScale:i}},p=(e,t,a,n=[0,0,0],s=[0,0,0,1],i=[1,1,1])=>{let u=a;1===i[0]&&1===i[1]&&1===i[2]||(u=a.map(((e,t)=>e*i[t%3])));return((e,t,a,n=[0,0,0],s=[0,0,0,1],i=[1,1,1])=>{const d=(t?l.Z.instance.RigidBodyDesc.fixed():l.Z.instance.RigidBodyDesc.dynamic()).setTranslation(n[0],n[1],n[2]).setRotation({x:s[0],y:s[1],z:s[2],w:s[3]}).setCanSleep(!0).setAngularDamping(.2).setLinearDamping(.2).setCcdEnabled(!1).setUserData({objectType:t?r.dL.static:r.dL.dynamic}),u=e.createRigidBody(d),f=l.Z.instance.ColliderDesc.cuboid(a[0],a[1],a[2]).setMass(.2).setFriction(1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Multiply).setRestitution(.2).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(t?c.bv:c.s4).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setActiveEvents(l.Z.instance.ActiveEvents.COLLISION_EVENTS);return e.createCollider(f,u),{collider:e.createCollider(f,u),rigidbody:u,halfExtents:a,dynamic:!1,shape:o.CUBOID,initPos:n,initRot:s,initScale:i}})(e,t,d.Se(u),n,s,i)},Z=(e,t,a,n,s,i=[0,0,0],u=[0,0,0,1],f=[1,1,1])=>{let g=a;return 1===f[0]&&1===f[1]&&1===f[2]||(g=a.map(((e,t)=>e*f[t%3]))),((e,t,a,n,s,i=[0,0,0],d=[0,0,0,1],u=[1,1,1])=>{const f=(t?l.Z.instance.RigidBodyDesc.fixed():l.Z.instance.RigidBodyDesc.dynamic()).setTranslation(i[0],i[1],i[2]).setRotation({x:d[0],y:d[1],z:d[2],w:d[3]}).setCanSleep(!0).setAngularDamping(.2).setLinearDamping(.2).setCcdEnabled(!1).setUserData({objectType:t?r.dL.static:r.dL.dynamic});n=Math.max(0,n||0),a[0]-=n,a[1]-=n,a[2]-=n,a[0]=Math.max(.1,a[0]),a[1]=Math.max(.1,a[1]),a[2]=Math.max(.1,a[2]),a[0]*=s,a[1]*=s,a[2]*=s;const g=e.createRigidBody(f),p=l.Z.instance.ColliderDesc.roundCuboid(a[0],a[1],a[2],n).setMass(.2).setFriction(1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Multiply).setRestitution(.2).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(t?c.bv:c.s4).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setActiveEvents(l.Z.instance.ActiveEvents.COLLISION_EVENTS);return e.createCollider(p,g),{collider:e.createCollider(p,g),rigidbody:g,halfExtents:a,dynamic:!1,shape:o.CUBOID,initPos:i,initRot:d,initScale:u}})(e,t,d.Se(g),n,s,i,u,f)},h=(e,t,a,n=[0,0,0],s=[0,0,0,1],i=[1,1,1])=>{const d=(t?l.Z.instance.RigidBodyDesc.fixed():l.Z.instance.RigidBodyDesc.dynamic()).setTranslation(n[0],n[1],n[2]).setRotation({x:s[0],y:s[1],z:s[2],w:s[3]}).setCanSleep(!0).setAngularDamping(.2).setLinearDamping(.2).setCcdEnabled(!1).setUserData({objectType:t?r.dL.static:r.dL.dynamic}),u=e.createRigidBody(d),f=l.Z.instance.ColliderDesc.ball(a).setMass(.2).setFriction(1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Multiply).setRestitution(.2).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(t?c.bv:c.s4).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setActiveEvents(l.Z.instance.ActiveEvents.COLLISION_EVENTS);return e.createCollider(f,u),{collider:e.createCollider(f,u),rigidbody:u,dynamic:!1,shape:o.SPHERE,initPos:n,initRot:s,initScale:i}};function y(e){const t=[];for(let a=0;a<e.numColliders();a++)t[a]=e.collider(a).collisionGroups();return t}var v=a(16319),m=a(28697),b=a(22971),w=a(31215),I=a(2375),C=a(57814),A=a(84062),k=a(29210),T=a(22857),N=a(23569),E=a(24974),M=a(5473),S=a(8430),D=a(61728),R=a(93295),j=a(85080),x=a(86582),P=a(28876),L=a(43715),W=a(26068),B=a(71107),V=a(19784),O=a(68199),U=a(10562),G=a(73251),F=a(75903),z=a(44963),J=a(59252),Y=a(75921),_=a(53393);const q=(0,_.J4)("curlingSurface",(()=>({isNetworked:!0,value:{}}))),H=(0,_.J4)("curlingStartArea",(()=>({isNetworked:!0,value:{totalJumpCount:1}})));var $=a(95831),Q=a(1205),X=a(17579),K=a(75622),ee=a(81723),te=a(44120),ae=a(57306),oe=a(96033),ne=a(47088),se=a(13008),ie=a(60320),re=a(72366),le=a(25721),ce=a(86904),de=a(53241),ue=a(80523),fe=a(25077),ge=a(39038),pe=a(17803),Ze=a(82417),he=a(28857),ye=a(11837),ve=a(41624),me=a(34769),be=a(51818),we=a(30144),Ie=a(65958),Ce=a(34586),Ae=a(57642),ke=a(8796),Te=a(70900),Ne=a(41465),Ee=a(19292),Me=a(94772),Se=a(84169),De=a(33805),Re=a(98014),je=a(2934),xe=a(79007),Pe=a(85903);function Le(e,t){u.Z.Debug("creating the OLD car!",e);const a=C.Z.createEntity([ie.Z,se.Z,fe.Z,S.Z,D.Z],!0,t);let o;t||a.add(Ne.Z),o=e?ke.Z.getCollectible(e):ke.Z.getCollectiblesByType(Te.J.car)[0];const s=o.resourceIds.drivable,i=Ce.Z.getResourceSync(s),{bodyObjectId:d,wheelObjectId:f}=i.data;a.addWithValue(b.Z,{isNetworked:!0,value:{objectId:d,objectType:r.dL.car,collectible:{type:Te.J.car,id:o.id}}});const g=i.data.wheels.map((e=>({type:e.type,springOrigin:e.springOrigin,springDirection:e.springDirection,springStrength:e.springStrength,springStiffness:e.springStiffness,rayLength:e.rayLength,grounded:!0,lastRayDistance:0,wheelOffsetY:0,angle:0}))),p={...M.v2,wheels:[],forceValue:0,steerValue:0};a.addWithValue(O.Z,{isNetworked:!0,value:p}),a.add(Ze.Z,E.Z,re.Z);for(let e=0;e<g.length;e++){const t=g[e],o=C.Z.createEntity([],!1);(0,le.VC)(a,o);const s=t.type===je.g.FRONT_LEFT||t.type===je.g.FRONT_RIGHT;o.addWithValue(ue.Z,{value:{index:e,type:t.type,offset:[t.springOrigin[0],t.springOrigin[1],t.springOrigin[2]+(s?.35:0)],distance:0,angle:0,speed:0}}),p.wheels[e]=t,o.getMutable(ie.Z).value=n.vc((0,ee.V)(),t.springOrigin);{const e=C.Z.createEntity([ie.Z,se.Z],!1);(0,le.VC)(o,e);const t=C.Z.createEntity([se.Z],!1),a=n.Us((0,ee.V)(),i.data.wheelAngleY/180*Math.PI,[0,1,0]);t.addWithValue(ie.Z,{value:a});const s=(0,k.fh)();t.getMutable(se.Z).sharedBuffer=s,(0,le.VC)(e,t),(0,x.nw)({type:P.p.AddGameobject,objectId:f,localId:t.get(de.Z).value.localId,sharedWorldTransformByteOffset:s.byteOffset})}}a.add(U.Z);const Z=l.Z.instance.RigidBodyDesc.dynamic().setTranslation(0,0,0).setRotation({x:0,y:0,z:0,w:1}).setCcdEnabled(ne.Av).setLinearDamping(ne.TD).setAngularDamping(ne.rC).setGravityScale(p.gravityScale).setCanSleep(!1).setUserData({objectType:r.dL.car,entity:a}),h=c.ZP.physicsWorld.createRigidBody(Z),m=l.Z.instance.ColliderDesc.cuboid(1.5,.5,2).setMass(10).setFriction(0).setRestitution(0).setTranslation(0,-.1,0).setCollisionGroups(c.tK),w=l.Z.instance.ColliderDesc.roundCuboid(.7,.13,1.8,.2).setDensity(0).setFriction(.5).setRestitution(.1).setTranslation(0,-.3,0).setCollisionGroups(c.s4).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setActiveEvents(l.Z.instance.ActiveEvents.COLLISION_EVENTS),A=l.Z.instance.ColliderDesc.roundCuboid(.55,.32,.95,.2).setDensity(0).setFriction(.5).setRestitution(.1).setTranslation(0,0,.6).setCollisionGroups(c.s4);c.ZP.physicsWorld.createCollider(m,h),c.ZP.physicsWorld.createCollider(w,h),c.ZP.physicsWorld.createCollider(A,h),a.addWithValue(v.Z,{value:{rigidbody:h,colliderGroups:y(h)}});const T=[];for(let e=0;e<h.numColliders();e++){const t=h.collider(e);T[e]={isSensor:t.isSensor(),collisionGroups:t.collisionGroups()}}a.addWithValue(I.Z,{isNetworked:!0,value:{bodyType:h.bodyType(),colliders:T,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0},linvel:{x:0,y:0,z:0},angvel:{x:0,y:0,z:0}}});{const e=C.Z.createEntity([se.Z],!1),t=(0,ee.V)();n.uD(t,t,i.data.bodyAngleY/180*Math.PI),n.Iu(t,t,i.data.bodyTranslation),e.addWithValue(ie.Z,{value:t}),(0,le.VC)(a,e);const o=(0,k.fh)();e.getMutable(se.Z).sharedBuffer=o,(0,x.nw)({type:P.p.AddGameobject,objectId:d,localId:e.get(de.Z).value.localId,sharedWorldTransformByteOffset:o.byteOffset});const s=(0,k.fh)();a.getMutable(se.Z).sharedBuffer=s,(0,x.nw)({type:P.p.AddGameobject,localId:a.get(de.Z).value.localId,sharedWorldTransformByteOffset:s.byteOffset}),(0,x.nw)({type:P.p.AddShadowDecal,targetLocalId:a.get(de.Z).value.localId})}return u.Z.Debug("Worker Thread: created a car entity! mass:",h.mass()),a}function We(e,t,a){const{vertices:o,indices:n,translation:s,rotation:i,scale:d,extras:{collider:m}}=e,w=C.Z.createEntity([],!t);let A;switch(w.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),u.Z.Debug("collider",m,"gameobject",e.name),e.extras.collider){case"box":if(o){const e=p(c.ZP.physicsWorld,t,o,s,i,d);({rigidbody:A}=e)}else{const e=(t?l.Z.instance.RigidBodyDesc.fixed():l.Z.instance.RigidBodyDesc.dynamic()).setTranslation(s[0],s[1],s[2]).setRotation({x:i[0],y:i[1],z:i[2],w:i[3]}).setCcdEnabled(!1);A=c.ZP.physicsWorld.createRigidBody(e);const a=l.Z.instance.ColliderDesc.cuboid(d[0],d[1],d[2]);c.ZP.physicsWorld.createCollider(a,A)}break;case"roundedBox":{u.Z.Debug("added roundedBox");const{extras:{radius:a,colliderScale:n}}=e;A=Z(c.ZP.physicsWorld,t,o,a,n,s,i,d).rigidbody;break}case"sphere":{const{extras:{radius:a}}=e;A=h(c.ZP.physicsWorld,t,a,s,i,d).rigidbody;break}case"hull":A=g(c.ZP.physicsWorld,t,o,s,i,d).rigidbody;break;default:{const e=f(c.ZP.physicsWorld,t,o,n,s,i,d);e&&(A=e.rigidbody);break}}switch(e.objectType){case r.dL.dynamic:if(e.extras.isStaticUntilHit){for(let e=0;e<A.numColliders();e++)A.collider(e).setSensor(!0),A.collider(e).setCollisionGroups(c._9);A.setBodyType(l.Z.instance.RigidBodyType.Fixed,!0),w.add(X.Z)}break;case r.dL.static:{const{friction:t,restitution:a}=e.extras;if(void 0!==t||void 0!==a)for(let e=0;e<A.numColliders();e++)void 0!==t&&A.collider(e).setFriction(+t),void 0!==a&&A.collider(e).setRestitution(+a);break}case r.dL.targetFollower:{const{restitution:t}=e.extras;if(void 0!==t)for(let e=0;e<A.numColliders();e++)A.collider(e).setRestitution(+t);break}}w.addWithValue(v.Z,{value:{rigidbody:A,colliderGroups:y(A)}});const T=[];for(let e=0;e<A.numColliders();e++){const t=A.collider(e);T[e]={isSensor:t.isSensor(),collisionGroups:t.collisionGroups()}}if(t||(w.addWithValue(I.Z,{isNetworked:!0,value:{bodyType:A.bodyType(),colliders:T,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0},linvel:{x:0,y:0,z:0},angvel:{x:0,y:0,z:0}}}),w.add(ie.Z),w.add(se.Z)),e.visible){let o;t||(o=(0,k.fh)(),w.getMutable(se.Z).sharedBuffer=o),(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:w.get(de.Z).value.localId,sharedWorldTransformByteOffset:o?.byteOffset,loadingLabel:a})}return{entity:w,rigidbody:A}}function Be(e,t){const{translation:a,rotation:o,scale:n,vertices:d,indices:u}=t.gameobjectDef,f=t.gameobjectDef.extras,g="mesh"===f?.collider;if(e.has(v.Z)||g){if("mesh"===f?.collider&&d&&u&&!e.has(v.Z)){const t=l.Z.instance.RigidBodyDesc.kinematicPositionBased().setTranslation(a[0],a[1],a[2]).setRotation({x:o[0],y:o[1],z:o[2],w:o[3]}).setCanSleep(!1).setCcdEnabled(!1).setUserData({objectType:r.dL.rotation}),s=c.ZP.physicsWorld.createRigidBody(t);let i=d;1===n[0]&&1===n[1]&&1===n[2]||(i=d.map(((e,t)=>e*n[t%3])));const g=l.Z.instance.ColliderDesc.trimesh(i,u).setMass(.2).setFriction(void 0!==f?.friction?+f.friction:1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setRestitution(void 0!==f?.restitution?+f.restitution:0).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(c.m0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL);c.ZP.physicsWorld.createCollider(g,s),e.addWithValue(v.Z,{value:{rigidbody:s,colliderGroups:y(s)}});const p=[];for(let e=0;e<s.numColliders();e++){const t=s.collider(e);p[e]={isSensor:t.isSensor(),collisionGroups:t.collisionGroups()}}e.addWithValue(I.Z,{isNetworked:!0,value:{bodyType:s.bodyType(),colliders:p,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0},linvel:{x:0,y:0,z:0},angvel:{x:0,y:0,z:0}}})}}else{e.add(Se.Z);const t=e.getMutable(Se.Z).value;s.JG(t.translation,a),i.JG(t.rotation,o),s.JG(t.scale,n)}}function Ve({localTranslation:e,localRotation:t,localScale:a,extras:{resourceId:o}}){const s=C.Z.createEntity([se.Z],!1);return s.addWithValue(ie.Z,{value:n.Iw((0,ee.V)(),t,e,a)}),Ce.Z.getResource(o).then((e=>{void 0!==e?be.q.getGltf(e.data.gltf).then((t=>{if(e.data.objectId){const t=be.q.getGameobjectById(e.data.objectId);if(!t)return;const a=(0,k.fh)();return s.getMutable(se.Z).sharedBuffer=a,void(0,x._o)({type:P.p.AddGameobject,objectName:t.gameobjectDef.name,localId:s.get(de.Z).value.localId,sharedWorldTransformByteOffset:a.byteOffset,loadingLabel:Ae.b.placeholder})}const{gameobjectDefs:a}=t,o=new Map;for(const e of a){let t=(0,Re.SI)(e,!0,!0,Ae.b.placeholder,o);if(!t){t=C.Z.createEntity([se.Z],!1),t.addWithValue(ie.Z,{value:n.Iw((0,ee.V)(),e.gameobjectDef.rotation,e.gameobjectDef.translation,e.gameobjectDef.scale)});const a=(0,k.fh)();t.getMutable(se.Z).sharedBuffer=a,(0,x.nw)({type:P.p.AddGameobject,objectName:e.gameobjectDef.name,localId:t.get(de.Z).value.localId,sharedWorldTransformByteOffset:a.byteOffset,loadingLabel:Ae.b.placeholder})}(0,le.VC)(s,t)}(0,Re.eG)(t,o)})):u.Z.Error("placeholder resource not found",o)})),s}function Oe(e,t,a,o){switch(e.objectType){case r.dL.trigger:return function(e){const{vertices:t,translation:a,rotation:o,scale:n,extras:{triggerType:s,lockCar:i}}=e,d=C.Z.createEntity([],!1);d.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),d.addWithValue(he.Z,{isNetworked:!0,value:{triggerType:s,lockCar:!!i}});const f=l.Z.instance.RigidBodyDesc.fixed().setTranslation(a[0],a[1],a[2]).setRotation({x:o[0],y:o[1],z:o[2],w:o[3]}).setUserData({objectType:r.dL.trigger,entity:d}),g=c.ZP.physicsWorld.createRigidBody(f),p=n.map((e=>Math.abs(e))),Z=t?p[0]/2:p[0],h=t?p[1]/2:p[1],w=t?p[2]/2:p[2],I=l.Z.instance.ColliderDesc.cuboid(Z,h,w).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);switch(c.ZP.physicsWorld.createCollider(I,g),d.addWithValue(v.Z,{value:{rigidbody:g,colliderGroups:y(g)}}),e.extras.triggerType){case"boostPad":{const{extras:{multiplier:t}}=e;void 0!==t?d.addWithValue(m.Z,{isNetworked:!0,value:{multiplier:t}}):d.add(m.Z),u.Z.Debug("created boost pad trigger",e.name);break}case"hotspot":{const{extras:{trigger:t}}=e;void 0!==t?d.addWithValue(W.Z,{isNetworked:!0,value:{trigger:t}}):d.add(W.Z),u.Z.Debug("created hotspot trigger",e.name);break}case"checkpoint":{const{extras:{index:t,timeLimit:n}}=e;let s;if(j.Z.has(V.Z))s=j.Z.getMutable(V.Z).value;else{const e=V.Z[1]();j.Z.addWithValue(V.Z,e),s=e.value}t>s.finishIndex?s.finishIndex=t:void 0===t&&(s.timeLimitInFrames=Math.ceil(n*G.y7),s.translation=(0,te.wQ)(s.translation,a),s.rotation=(0,te.r1)(s.rotation,o)),d.addWithValue(B.Z,{isNetworked:!0,value:{index:t}}),u.Z.Debug("created checkpoint trigger",e.name);break}case"leaderboard":u.Z.Debug("created leaderboard trigger",e.name);break;case"notification":{const{extras:{notificationName:t}}=e;d.addWithValue(K.Z,{isNetworked:!0,value:{notificationName:t}}),u.Z.Debug("created notification trigger",e.name);break}case"camera":{const{extras:{distance:t,minDistance:a,stiffness:o,highSpeedAngle:n,lowSpeedAngle:s}}=e;d.addWithValue(ye.Z,{isNetworked:!0,value:{distance:t,minDistance:a,stiffness:o,highSpeedAngle:n,lowSpeedAngle:s}}),u.Z.Debug("created camera trigger",e.name);break}case"spawn":{const{extras:{spawnPointName:t}}=e;d.addWithValue(ve.Z,{isNetworked:!0,value:{spawnPointName:t}}),u.Z.Debug("created spawn trigger",e.name);break}case"carVisualizer":{const{extras:{resourceId:t,targetName:a}}=e;d.addWithValue(Ie.Z,{isNetworked:!0,value:{resourceId:t,targetName:a}}),Ce.Z.getResource(t).then((e=>{void 0!==e?be.q.getGltf(e.data.gltf,!0).then((e=>{})):u.Z.Error("carVisualizer resource not found",t)})),u.Z.Debug("created car visualizer trigger",e.name);break}case"oled":u.Z.Debug("created oled trigger",e.name);break;case"spikeOuter":case"spikeInner":case"spikeEcoInner01":case"spikeEcoOuter01":case"spikeEcoInner02":case"spikeEcoOuter02":case"spikeEcoInner03":case"spikeEcoOuter03":case"spikeInnerDrop":case"spikeOuterDrop":u.Z.Debug("created spike trigger",e.name);break;case"disclaimer":{const{extras:{disclaimerId:t}}=e;d.addWithValue(Me.Z,{value:{disclaimerId:t}}),u.Z.Debug("created disclaimer trigger",e.name);break}case"drop":{const{extras:{resourceId:t}}=e;d.addWithValue(xe.Z,{value:{resourceId:t}});const a=Ce.Z.getResourceSync(t);a?.data?.gltf?be.q.getGltf(a.data.gltf,!0):u.Z.Error("drop resource not found",t);break}case"quiz_answer":{const{extras:{quizId:t,correctAnswer:a}}=e;d.addWithValue(Pe.Z,{value:{quizId:t,correctAnswer:"boolean"==typeof a?a:"false"!==a}});break}}return d}(e);case r.dL.car:return Le(e.extras.collectibleId,a);case r.dL.spawnPoint:return function(e){const{translation:t,rotation:a,extras:{spawnPointType:o,spawnPointName:s,spawnPointGroup:i,spawnPointSpeed:d}}=e;let f;switch(o){case"portal":f=w.I.portal;break;case"charger":f=w.I.charger;break;case"random":f=w.I.random;break;case"quiz":f=w.I.quiz;break;default:f=w.I.custom}const g=C.Z.createEntity([],!1);g.addWithValue(se.Z,{value:n.yl((0,ee.V)(),a,t)}),g.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),g.addWithValue(w.Z,{isNetworked:!0,value:{type:f,name:s??e.name,group:i,translation:t,rotation:a,speed:d??0}});const p=[10,10,10],Z=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1]-.4*p[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setUserData({objectType:r.dL.spawnGhostModeArea,entity:g}),h=c.ZP.physicsWorld.createRigidBody(Z),m=l.Z.instance.ColliderDesc.cuboid(p[0]/2,p[1]/2,p[2]/2).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(m,h),g.addWithValue(v.Z,{value:{rigidbody:h,colliderGroups:y(h)}}),u.Z.Debug("created spawn point",s??e.name,o),g}(e);case r.dL.icySurface:return function(e){const{translation:t,rotation:a,scale:o,extras:{forward:n,side:s,turn:i,collider:d}}=e,f=C.Z.createEntity([],!1);f.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}});const g=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setCcdEnabled(!1).setUserData({objectType:r.dL.icySurface,entity:f}),p=c.ZP.physicsWorld.createRigidBody(g),Z=("sphere"===d?l.Z.instance.ColliderDesc.ball(o[0]):l.Z.instance.ColliderDesc.cuboid(o[0]/2,o[1]/2,o[2]/2)).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(Z,p),void 0!==n?f.addWithValue(F.Z,{isNetworked:!0,value:{forward:n,side:s,turn:i}}):f.add(F.Z),f.addWithValue(v.Z,{value:{rigidbody:p,colliderGroups:y(p)}}),u.Z.Debug("created icy surface",e.name),f}(e);case r.dL.crown:return function(e){const{translation:t,rotation:a,localTranslation:o,localRotation:s,extras:{targetDuration:i}}=e,d=C.Z.createEntity([ie.Z,se.Z,re.Z]);d.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}});const u=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setCcdEnabled(!1).setUserData({objectType:r.dL.crown,entity:d}),f=c.ZP.physicsWorld.createRigidBody(u),g=l.Z.instance.ColliderDesc.ball(5).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);c.ZP.physicsWorld.createCollider(g,f),d.addWithValue(T.Z,{isNetworked:!0,value:{targetDuration:i,taken:!1}}),d.addWithValue(v.Z,{value:{rigidbody:f,colliderGroups:y(f)}});const p=[];for(let e=0;e<f.numColliders();e++){const t=f.collider(e);p[e]={isSensor:t.isSensor(),collisionGroups:t.collisionGroups()}}d.addWithValue(I.Z,{isNetworked:!0,value:{bodyType:f.bodyType(),colliders:p,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0},linvel:{x:0,y:0,z:0},angvel:{x:0,y:0,z:0}}});{const t=C.Z.createEntity([ce.Z],!1);t.addWithValue(ie.Z,{value:n.yl((0,ee.V)(),s,o)});const a=(0,k.fh)();t.addWithValue(se.Z,{sharedBuffer:a,value:(0,ee.V)()}),(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:t.get(de.Z).value.localId,sharedWorldTransformByteOffset:a.byteOffset})}return d}(e);case r.dL.portal:return function(e){const{translation:t,rotation:a,scale:o,extras:{target:n,random:s}}=e,i=C.Z.createEntity([],!1);i.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}});const d=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setCcdEnabled(!1).setUserData({objectType:r.dL.portal,entity:i}),f=c.ZP.physicsWorld.createRigidBody(d),g=o.map((e=>Math.abs(e))),p=l.Z.instance.ColliderDesc.cuboid(g[0]/2,g[1]/2,g[2]/2).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(p,f),i.addWithValue(L.Z,{isNetworked:!0,value:{levelName:n,random:s}}),i.addWithValue(v.Z,{value:{rigidbody:f,colliderGroups:y(f)}}),u.Z.Debug("created a portal! -> ",e.name),i}(e);case r.dL.targetFollower:return function(e,t){const{entity:a,rigidbody:o}=We(e,!1,t);o&&(o.userData={objectType:r.dL.targetFollower,entity:a});const s=n.yl((0,ee.V)(),e.rotation,e.translation);return a.addWithValue(N.Z,{isNetworked:!0,value:{targetTransform:s,posStiffness:e.extras.posStiffness,rotStiffness:e.extras.rotStiffness}}),u.Z.Debug("target follower added"),a}(e,o);case r.dL.curlingCenter:return function(e){const{translation:t,scale:a}=e,o=C.Z.createEntity([],!1);return o.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),o.addWithValue(Y.Z,{isNetworked:!0,value:{radius:a[0],translation2d:[t[0],t[2]]}}),u.Z.Debug("created a curling center! -> ",e.name),o}(e);case r.dL.curlingSurface:return function(e){const{translation:t,rotation:a,scale:o}=e,n=C.Z.createEntity([],!1);n.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}});const s=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setCcdEnabled(!1).setUserData({objectType:r.dL.curlingSurface,entity:n}),i=c.ZP.physicsWorld.createRigidBody(s),d=l.Z.instance.ColliderDesc.cuboid(o[0]/2,o[1]/2,o[2]/2).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(d,i),n.add(q),n.addWithValue(v.Z,{value:{rigidbody:i,colliderGroups:y(i)}}),u.Z.Debug("created curling surface",e.name),n}(e);case r.dL.curlingStartPoint:return function(e){const{translation:t,rotation:a,scale:o,extras:{jumpCount:n}}=e,s=C.Z.createEntity([],!1);s.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}});const i=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setCcdEnabled(!1).setUserData({objectType:r.dL.curlingStartPoint,entity:s}),d=c.ZP.physicsWorld.createRigidBody(i),f=l.Z.instance.ColliderDesc.cuboid(o[0],o[1],o[2]).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(f,d),s.addWithValue(H,{isNetworked:!0,value:{totalJumpCount:n}}),s.addWithValue(v.Z,{value:{rigidbody:d,colliderGroups:y(d)}}),u.Z.Debug("created curling start point",e.name),s}(e);case r.dL.curlingSpawnStart:return function(e){const{translation:t,rotation:a}=e,o=C.Z.createEntity([],!1);return o.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),o.addWithValue($.Z,{isNetworked:!0,value:{translation:t,rotation:a}}),u.Z.Debug("created curling spawn start point"),o}(e);case r.dL.curlingSpawnEnd:return function(e){const{translation:t,rotation:a}=e,o=C.Z.createEntity([],!1);o.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),o.addWithValue(Q.Z,{isNetworked:!0,value:{translation:t,rotation:a}});const n=[10,10,10],s=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1]-.4*n[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setUserData({objectType:r.dL.spawnGhostModeArea,entity:o}),i=c.ZP.physicsWorld.createRigidBody(s),d=l.Z.instance.ColliderDesc.cuboid(n[0]/2,n[1]/2,n[2]/2).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(d,i),o.addWithValue(v.Z,{value:{rigidbody:i,colliderGroups:y(i)}}),u.Z.Debug("created curling spawn start point"),o}(e);case r.dL.muralHotspot:return function(e){const{translation:t,rotation:a,scale:o,extras:{muralWallId:n}}=e,s=C.Z.createEntity([],!1);s.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}});const i=l.Z.instance.RigidBodyDesc.fixed().setTranslation(t[0],t[1],t[2]).setRotation({x:a[0],y:a[1],z:a[2],w:a[3]}).setCcdEnabled(!1).setUserData({objectType:r.dL.muralHotspot,entity:s}),d=c.ZP.physicsWorld.createRigidBody(i),f=l.Z.instance.ColliderDesc.cuboid(o[0],o[1],o[2]).setSensor(!0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL).setCollisionGroups(c._9);return c.ZP.physicsWorld.createCollider(f,d),s.addWithValue(ae.Z,{isNetworked:!0,value:{muralWallId:n}}),s.addWithValue(v.Z,{value:{rigidbody:d,colliderGroups:y(d)}}),u.Z.Debug("created a mural hotspot! -> ",e.name),s}(e);case r.dL.muralWall:return function(e){const{translation:t,rotation:a,extras:{muralWallId:o}}=e,n=C.Z.createEntity([],!1);return n.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),n.addWithValue(oe.Z,{isNetworked:!0,value:{id:o,translation:t,rotation:a}}),(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:n.get(de.Z).value.localId}),u.Z.Debug("created a mural wall! -> ",e.name),n}(e);case r.dL.hotspotMarker:return function(e){const{translation:t,rotation:a,scale:o}=e,i=C.Z.createEntity([ie.Z,se.Z],!1),r=s.al(0,1,0);i.addWithValue(ge.Z,{isNetworked:!0,value:{axis:r,speed:.2}}),i.addWithValue(pe.Z,{value:{axis:r,speed:1.6,distance:.6,t:0,direction:!0,originalTranslation:t}});const l=C.Z.createEntity([se.Z,re.Z],!1),c=n.Iw((0,ee.V)(),a,t,o);l.addWithValue(ie.Z,{value:c}),(0,le.VC)(l,i);const d=(0,k.fh)();return i.getMutable(se.Z).sharedBuffer=d,(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:i.get(de.Z).value.localId,sharedWorldTransformByteOffset:d.byteOffset}),l}(e);case r.dL.rotation:return function(e){const{vertices:t,indices:a,translation:o,rotation:i,scale:d,extras:{rotationAxis:u,rotationSpeed:f,collider:g,friction:p,restitution:Z}}=e,h=C.Z.createEntity([ie.Z,se.Z],!!g);let m;switch(u){case"x":default:m=s.al(1,0,0);break;case"y":m=s.al(0,1,0);break;case"z":m=s.al(0,0,1)}if(h.addWithValue(ge.Z,{isNetworked:!0,value:{axis:m,speed:f}}),e.visible){const t=(0,k.fh)();h.getMutable(se.Z).sharedBuffer=t,(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:h.get(de.Z).value.localId,sharedWorldTransformByteOffset:t.byteOffset})}if("mesh"===g&&t&&a){const e=l.Z.instance.RigidBodyDesc.kinematicPositionBased().setTranslation(o[0],o[1],o[2]).setRotation({x:i[0],y:i[1],z:i[2],w:i[3]}).setCanSleep(!1).setCcdEnabled(!1).setUserData({objectType:r.dL.rotation}),n=c.ZP.physicsWorld.createRigidBody(e);let s=t;1===d[0]&&1===d[1]&&1===d[2]||(s=t.map(((e,t)=>e*d[t%3])));const u=l.Z.instance.ColliderDesc.trimesh(s,a).setMass(.2).setFriction(void 0!==p?+p:1).setFrictionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setRestitution(void 0!==Z?+Z:0).setRestitutionCombineRule(l.Z.instance.CoefficientCombineRule.Max).setCollisionGroups(c.m0).setActiveCollisionTypes(l.Z.instance.ActiveCollisionTypes.ALL);c.ZP.physicsWorld.createCollider(u,n),h.addWithValue(v.Z,{value:{rigidbody:n,colliderGroups:y(n)}});const f=[];for(let e=0;e<n.numColliders();e++){const t=n.collider(e);f[e]={isSensor:t.isSensor(),collisionGroups:t.collisionGroups()}}return h.addWithValue(I.Z,{isNetworked:!0,value:{bodyType:n.bodyType(),colliders:f,translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:0},linvel:{x:0,y:0,z:0},angvel:{x:0,y:0,z:0}}}),h}const b=C.Z.createEntity([se.Z],!1),w=n.Iw((0,ee.V)(),i,o,d);return b.addWithValue(ie.Z,{value:w}),(0,le.VC)(b,h),b}(e);case r.dL.carSelection:return C.Z.createEntity([me.Z],!1);case r.dL.target:return function(e,t){const{translation:a,rotation:o,scale:s,extras:{resourceId:i,targetType:r,targetName:l}}=e,c=C.Z.createEntity([se.Z],!t);return c.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),c.addWithValue(we.Z,{isNetworked:!0,value:{name:l,type:r,resourceId:i}}),c.addWithValue(ie.Z,{value:n.yl((0,ee.V)(),o,a)}),i&&Ce.Z.getResource(i).then((e=>{})),u.Z.Debug("created a target",l),c}(e,t);case r.dL.movable:return function(e,t){const{translation:a,rotation:o}=e,s=C.Z.createEntity([],!1);s.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),s.addWithValue(ie.Z,{value:n.yl((0,ee.V)(),o,a)});const i=(0,k.fh)();return s.addWithValue(se.Z,{sharedBuffer:i,value:(0,ee.V)()}),(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:s.get(de.Z).value.localId,loadingLabel:t,sharedWorldTransformByteOffset:i.byteOffset}),u.Z.Debug("created a movable",e.name),s}(e,o);case r.dL.oledScreen:return function(e){const{translation:t,rotation:a,extras:{resourceId:o}}=e,s=C.Z.createEntity([],!1);return s.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),s.addWithValue(se.Z,{value:n.yl((0,ee.V)(),a,t)}),s.addWithValue(Ee.Z,{value:{resourceId:o}}),Ce.Z.getResource(o).then((e=>{void 0===e&&u.Z.Error("oled resource not found",o)})),(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:s.get(de.Z).value.localId}),u.Z.Debug("created a oled screen",e.name),s}(e);case r.dL.cloud:return function(e){const{translation:t,rotation:a,scale:o}=e,s=C.Z.createEntity([],!1);s.addWithValue(b.Z,{isNetworked:!0,value:{objectName:e.name,objectType:e.objectType}}),s.addWithValue(ie.Z,{value:n.Iw((0,ee.V)(),a,t,o)});const i=(0,k.fh)();s.addWithValue(se.Z,{sharedBuffer:i,value:(0,ee.V)()});const r=s.get(de.Z).value.localId;return(0,x.nw)({type:P.p.AddGameobject,objectName:e.name,localId:r,sharedWorldTransformByteOffset:i.byteOffset}),(0,x._o)({type:P.p.CloudAdded,localId:r}),u.Z.Debug("created a cloud",e.name),s}(e);case r.dL.placeholder:return Ve(e);case r.dL.static:{const{entity:t,rigidbody:a}=We(e,!0,o);return a&&(a.userData={objectType:r.dL.static,entity:t}),t}case r.dL.dynamic:{const{entity:t,rigidbody:a}=We(e,!1,o);if(a&&(a.userData={objectType:r.dL.dynamic,entity:t}),e.extras.resetAfter){const a=j.Z.get(J.Z).value.current;t.addWithValue(z.Z,{isNetworked:!0,value:{resetAfterFrames:e.extras.resetAfter/G.yn,lastResetFrameNo:a,translation:{x:e.translation[0],y:e.translation[1],z:e.translation[2]},rotation:{x:e.rotation[0],y:e.rotation[1],z:e.rotation[2],w:e.rotation[3]}}})}return t}default:return e.objectType in r.dL&&u.Z.Debug("Unknown object type:",e.objectType),null}}const Ue=Symbol.keyFor(R.Z[0]),Ge=Symbol.keyFor(b.Z[0]);function Fe(e,t){if(!e){const{networkId:a}=t[Ue],o=t[Ge];if(!o)return;if(o.collectible)o.collectible.type===Te.J.car&&(e=Le(o.collectible.id,a));else{const t=be.q.getGameobjectByName(o.objectName);if(!t)return void u.Z.Error("gameobjectDef not found",o.objectName);e=Oe(t.gameobjectDef,!1,a)}}const a=e.getAll();for(const o of Object.getOwnPropertySymbols(a))e.get([o,null]).isNetworked&&(t[Symbol.keyFor(o)]||C.Z.destroyComponent(e,[o,null],!0));for(const a of Object.keys(t)){if(A.hO[a]){A.hO[a](e,t[a]);continue}const o=t[a],n=[Symbol.for(a),null];if(e.has(n)){const t=e.getMutable(n).value;(0,De.p)(t,o)}else e.addWithValue(n,{isNetworked:!0,value:o})}}},9043:(e,t,a)=>{a.d(t,{Z:()=>g});var o=a(53393),n=a(21839),s=a(34689),i=a(13008),r=a(85080),l=a(59252),c=a(60531),d=a(1266);const u=new o.AE({world:s.Z,has:[i.Z],trackAdded:!0,trackMutated:[i.Z]});function f(e){const t=e.getMutable(i.Z);if(!t.sharedBuffer)return;const a=new Float32Array(t.sharedBuffer.buffer,t.sharedBuffer.byteOffset,d.P);n.JG(a,t.value),t.sharedBuffer[d.P]=1}function g(){const e=r.Z.get(l.Z).value;if((0,c.LN)()&&-1===e.snapshotFrameNo)return;const t=u.collect();for(const e of t.added)f(e);for(const e of t.mutated)f(e)}},1969:(e,t,a)=>{a.d(t,{Z:()=>s});var o=a(59252),n=a(85080);function s(e){const t=n.Z.getMutable(o.Z).value;return t.target+=e,t.target}},98014:(e,t,a)=>{a.d(t,{$L:()=>Y,SI:()=>q,eG:()=>_,ZP:()=>Q,WO:()=>z});var o=a(53393),n=a(21839),s=a(7962),i=a(46494),r=a(61137),l=a(63805),c=a(85080),d=a(60531),u=a(59252),f=a(57814),g=a(26508),p=a(42499),Z=a(21371),h=a(5758),y=a(86582),v=a(28876),m=a(20081),b=a(61371),w=a(25721),I=a(53241),C=a(43397),A=a(35416),k=a(51818),T=a(89262),N=a(16319),E=a(75550),M=a(29210),S=a(13008),D=a(91331),R=a(79514),j=a(60320),x=a(81723),P=a(21113),L=a(10631),W=a(93295),B=a(92903),V=a(72904),O=a(79276),U=a(30144),G=a(34689),F=a(79263);function z(e,t){const a=c.Z.getMutable(r.Z).value;if(e)for(const t of A.gr.values())if(t.data.name===e)return void(a.next=t);t||!A.Iq?a.next=function(e,t){let a=-1;if(0===e.size)return t;if(1===e.size)return e.values().next().value;do{a=Math.floor(Math.random()*e.size)}while(a===t?.data.index||!e.get(a)?.data.map);return e.get(a)}(A.gr,a.current):a.next=A.Iq}function J(){const e=c.Z.getMutable(u.Z).value;e.current=-1,e.target=-1,c.Z.has(g.Z)&&f.Z.destroyComponent(c.Z,g.Z),f.Z.destroyAllEntities(),(0,h.p5)()}function Y(e,t,a){if(e.has(N.Z)){const o={clipLabel:t.label,animationGroup:a,clipName:t.name,active:t.autoPlay,startFrame:void 0};e.has(R.Z)?e.getMutable(R.Z).value.animationStates.push(o):e.addWithValue(R.Z,{isNetworked:!0,value:{animationStates:[o]}})}else{const o={clipLabel:t.label,animationGroup:a,clipName:t.name,active:t.autoPlay,startTime:void 0};e.has(D.Z)?e.getMutable(D.Z).value.animationStates.push(o):e.addWithValue(D.Z,{value:{animationStates:[o]}})}}function _(e,t){const{animations:a}=e,o={};for(const n of a){o[n.name]=n;for(const a of n.channels)t.has(a.targetObjectName)&&Y(t.get(a.targetObjectName),n,e.url)}c.Z.has(T.Z)||c.Z.addWithValue(T.Z,{value:{clips:{}}});const{clips:n}=c.Z.getMutable(T.Z).value;n[e.url]=o}function q(e,t,a,o,s){let i=0;const r=e.gameobjectDef.extras?.state;if(r&&(i=(0,P.pQ)(r),0==((0,C.i3)()&i)))return;const c=e.gameobjectDef.objectType in l.dL;let d;if(c&&(d=(0,m.v8)(e.gameobjectDef,a,void 0,o)),e.hasAnimations){if(!d){const t=e.gameobjectDef.extras?.collider;d=f.Z.createEntity([S.Z],!!t);const{translation:a,rotation:o,scale:s}=e.gameobjectDef;if(d.addWithValue(j.Z,{value:n.Iw((0,x.V)(),o,a,s)}),e.gameobjectDef.visible){if(!d.get(S.Z).sharedBuffer){const e=(0,M.fh)();d.getMutable(S.Z).sharedBuffer=e}(0,y.nw)({type:v.p.AddGameobject,objectName:e.gameobjectDef.name,localId:d.get(I.Z).value.localId,sharedWorldTransformByteOffset:d.get(S.Z).sharedBuffer.byteOffset})}}(0,m.Nt)(d,e)}let u=!1;for(const t of e.children){const e=q(t,!0,a||d&&!d.has(W.Z),o,s);e&&!e.has(N.Z)?(d||(d=f.Z.createEntity([],!1)),(0,w.VC)(d,e)):u=!0}if(i&&(d?d.addWithValue(L.Z,{isNetworked:!0,value:{state:i,objectName:e.gameobjectDef.name}}):d||(d=f.Z.createEntity([],!1),d.addWithValue(L.Z,{isNetworked:!0,value:{state:i,objectName:e.gameobjectDef.name}}))),c||t||e.hasAnimations||(0,y.nw)({type:v.p.AddGameobject,objectName:e.gameobjectDef.name,localId:d?.get(I.Z).value.localId,loadingLabel:o}),d&&!e.gameobjectDef.visible&&(c||e.hasAnimations)&&u){const t=(0,M.fh)();d.getMutable(S.Z).sharedBuffer=t,(0,y.nw)({type:v.p.AddGameobject,objectName:e.gameobjectDef.name,localId:d.get(I.Z).value.localId,sharedWorldTransformByteOffset:t.byteOffset,dontRender:!0})}return s&&d&&s.set(e.gameobjectDef.name,d),d}const H=new o.AE({has:[U.Z],world:G.Z});let $;async function Q(){const e=c.Z.getMutable(r.Z).value;return e.loading?$?(e.current=e.next,e.loading=!1,(0,d.HB)(e.current.data.isLocal),c.Z.getMutable(u.Z).value.current=-1,c.Z.getMutable(u.Z).value.target=0,await async function(e,t){c.Z.has(b.Z)&&f.Z.destroyComponent(c.Z,b.Z),(0,y.nw)({type:v.p.LevelLoaded,levelIndex:e,gameobjectDefNames:t.gameobjectDefs.map((e=>e.gameobjectDef.name))}),await async function(e){Z.Z.Debug("Worker Thread: initLevel is called"),await async function(){h.ZP.physicsWorld&&J(),await(0,h.pl)()}();const t=await function(e){const t=new Map;for(const a of e)q(a,!1,!1,void 0,t);return t}(e.gameobjectDefs);await _(e,t),function(){const e=(0,O.c)(H.collect().entities,(e=>"levelCamera"===e.get(U.Z).value.name));e?B.c.addState((0,F.x)(e)):B.c.addState((0,V.J)(s.al(200,200,0),s.al(0,0,0)))}()}(t)}(e.current.data.index,$),$=void 0,Z.Z.Debug("loaded the level",e.current.data.name),{currentLevelIndex:e.current.data.index,loadedNewLevel:!0}):{currentLevelIndex:e.current?.data.index,loadedNewLevel:!1}:(e.loading||!e.next||e.current?.data.index===e.next.data.index||(e.loading=!0,e.current&&function(e,t){const a=c.Z.getMutable(u.Z).value;if(a.current=-1,a.target=-1,(0,p.TG)(),c.Z.has(g.Z)&&f.Z.destroyComponent(c.Z,g.Z),c.Z.has(E.Z)){const e=c.Z.getMutable(E.Z).value;Object.keys(e).forEach((t=>{e[t]=!1}))}J(),k.q.removeGltf(e),t?.forEach((e=>k.q.removeGltf(e)))}((0,i.p9)(e.current.data.gltf),e.childGltfs),(0,y.ot)(),(0,y.nw)({type:v.p.LevelLoading,levelIndex:e.next.data.index}),async function(e){$=await k.q.getGltf(e)}(e.next.data.gltf),(0,C.VJ)()),{currentLevelIndex:e.current?.data.index,loadedNewLevel:!1})}},75562:(e,t,a)=>{a.d(t,{Ek:()=>g,_e:()=>u,nF:()=>f});var o=a(59252),n=(a(15474),a(33805)),s=a(21371),i=a(3096),r=a(85080),l=a(42499),c=a(58183);let d=!1;function u(){return d}function f(){d=!1}function g(){const e=r.Z.get(o.Z).value,t=r.Z.getMutable(i.Z).value,a=r.Z.has(c.Z)?r.Z.get(c.Z).value.playerId:void 0;for(const o of t)o.playerId!==a&&(l.YJ[o.playerId]=l.YJ[o.playerId]||{},o.frameNo<e.current+1?(d=!0,s.Z.Warning(`late input: pID: ${o.playerId} input frame: ${o.frameNo} our frame: ${e.current}`),l.YJ[o.playerId][e.current+1]=(0,n.Q)(o.input)):(l.YJ[o.playerId][o.frameNo]&&s.Z.Warning(`Overwriting input for player ${o.playerId} frame ${o.frameNo}`),l.YJ[o.playerId][o.frameNo]=(0,n.Q)(o.input)));t.length=0}},91018:(e,t,a)=>{a.d(t,{Z:()=>m});var o=a(59252),n=a(21371),s=a(61371),i=a(85080),r=a(42499),l=a(57814),c=a(73251),d=a(43397),u=a(53393),f=a(5758),g=a(20081),p=a(93295),Z=(a(84062),a(34689));const h=new u.AE({world:Z.Z,has:[p.Z]});var y=a(51479),v=a(75562);function m(){if(!i.Z.has(s.Z))return!1;const e=i.Z.getMutable(o.Z).value,t=i.Z.get(s.Z).value,{snapshot:a}=t;n.Z.Debug("targetFrameNo",e.target),n.Z.Debug("snapshot.frameNo",a.frameNo),-1!==e.target&&e.target<a.frameNo&&n.Z.Debug("We are behind the server! This might happen if the local physics loop is slower than expected."),l.Z.destroyComponent(i.Z,s.Z),(0,r.rU)(a.frameNo,t.inputBuffer);let u=!1;if(-1===e.target||e.target<a.frameNo){const t=Math.ceil((0,d.J2)()/c.Ep/2),o=Math.ceil((0,d.J8)()/c.Ep),n=Math.max(t+o,c.OE),s=a.frameNo+n;e.target=s,u=!0}return n.Z.Debug("final targetFrameNo",e.target),e.diffWithServer=e.target-a.frameNo,(u||(0,v._e)()||a.frameNo%40<5)&&((0,v.nF)(),n.Z.Debug("calling await workerThread.value.SSSSSSSetSnapshot()"),function(e){if(n.Z.Debug("setSnapshot"),!f.ZP.physicsWorld)return;const t={};for(const a of h.collect().entities){const{networkId:o}=a.get(p.Z).value;e.entityByNetworkId[o]?t[o]=a:l.Z.destroyEntity(a)}for(const a of Object.keys(e.entityByNetworkId)){const o=e.entityByNetworkId[a],s=t[a];s||n.Z.Debug("no local entity with networkId ->",a),(0,g.OM)(s,o)}const a=i.Z.getMutable(o.Z).value;a.current=e.frameNo,a.snapshotFrameNo=e.frameNo}(a)),t.playersToSpawn.length&&n.Z.Debug("playersToSpawn",t.playersToSpawn),t.playersToRemove.length&&n.Z.Debug("playersToRemove",t.playersToRemove),y.default.setPlayersToSpawn(t.playersToSpawn),y.default.setPlayersToRemove(t.playersToRemove),!0}},38854:(e,t,a)=>{a.d(t,{j:()=>wo});var o=a(59252),n=a(73251),s=a(60531),i=a(21371),r=a(85080),l=a(53393),c=a(58183),d=a(8430),u=a(34689),f=a(89649),g=a(82417),p=a(57814);const Z=new l.AE({world:u.Z,has:[c.Z,d.Z],trackMutated:[d.Z]});var h=a(93295),y=a(42499),v=a(33805),m=a(45687),b=a(25077);const w=new l.AE({world:u.Z,has:[h.Z,c.Z,b.Z]});var I=a(82407),C=a(61728);const A=new l.AE({world:u.Z,has:[d.Z,C.Z]});var k=a(7962),T=a(22857),N=a(32429),E=a(63805);const M=(0,l.J4)("boost",(()=>({isNetworked:!0,value:{counter:1,multiplier:5}})));var S=a(28697),D=a(43715),R=a(16319),j=a(5758),x=a(86582),P=a(28876),L=a(26068),W=a(10562),B=a(71107);const V=(0,l.J4)("racer",(()=>({isNetworked:!0,value:{startFrame:0,lastIndex:null}})));var O=a(19784),U=a(75903);const G=(0,l.J4)("tireFrictionMultiplier",(()=>({isNetworked:!0,value:{counter:1,forward:1,side:1,turn:1}}))),F=(0,l.J4)("curlingSurfaceTouch",(()=>({isNetworked:!0,value:{counter:1}})));var z=a(17579),J=a(84888);const Y=(0,l.J4)("curlingMode",(()=>({isNetworked:!0,value:{jumpCount:0,totalScore:0}})));var _=a(75622),q=a(57306),H=a(47088),$=a(40137),Q=a(61137),X=a(16520),K=a(68988);const ee=(0,l.J4)("muralHotspotCountdown",(()=>({isNetworked:!0,value:{muralWallId:null,triggerFrameNo:0}})));var te=a(53241),ae=a(76239),oe=a(91549),ne=a(28857),se=a(11837),ie=a(41624),re=a(31215),le=a(44120),ce=a(65958),de=a(30144),ue=a(98014),fe=a(60538),ge=a(94772),pe=a(75550),Ze=a(10631),he=a(21113),ye=a(79007);const ve=(0,l.J4)("collectedItems",(()=>({isNetworked:!0,value:[]})));var me=a(79517),be=(a(6472),a(85903));const we=(0,l.J4)("quiz",(()=>({isNetworked:!0,value:{answers:{}}}))),Ie=(0,l.J4)("quizAnswerCountdown",(()=>({isNetworked:!0,value:{triggerFrameNo:0,correctAnswer:!1,quizId:""}}))),Ce=new l.AE({world:u.Z,has:[re.Z]}),Ae=(new l.AE({world:u.Z,has:[de.Z]}),k.Ue()),ke=k.Ue(),Te={};function Ne(e){if(p.Z.destroyComponent(e,z.Z),e.has(R.Z)){const{rigidbody:t}=e.getMutable(R.Z).value;for(let e=0;e<t.numColliders();e++)t.collider(e).setSensor(!1),t.collider(e).setCollisionGroups(j.s4);t.setBodyType(J.Z.instance.RigidBodyType.Dynamic,!0)}}Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.trigger])]=(e,t)=>{const a=e[(0,ae.E)(E.Yf[E.dL.car])][0],s=e[(0,ae.E)(E.Yf[E.dL.trigger])][0];if(s.has(Ze.Z)&&!(0,he.iq)(a,s.get(Ze.Z).value.state))return;const{triggerType:l,lockCar:d}=s.get(ne.Z).value;switch(l&&(r.Z.getMutable(pe.Z).value[l]=t),i.Z.Debug("triggered",l),l){case"boostPad":{const{multiplier:e}=s.get(S.Z).value;if(t)if(a.has(M))a.getMutable(M).value.counter++;else{a.addWithValue(M,{isNetworked:!0,value:{counter:1,multiplier:e}});const{localId:t}=a.get(te.Z).value;(0,x.nw)({type:P.p.BoostAcquired,localId:t})}else if(!t&&a.has(M)){const e=a.getMutable(M).value;e.counter--,e.counter<=0&&p.Z.destroyComponent(a,M)}break}case"hotspot":{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;if(!t)return void(0,x.nw)({type:P.p.HotspotTriggered,trigger:null});const{trigger:n}=s.get(L.Z).value;(0,x.nw)({type:P.p.HotspotTriggered,trigger:n});break}case"checkpoint":{const{playerId:e}=a.get(c.Z).value,o=e===(r.Z.has(c.Z)?r.Z.get(c.Z).value.playerId:void 0),n=s.get(B.Z).value.index;if(!a.has(V))return void(void 0===n&&o&&(0,x.nw)({type:P.p.RaceHotspotTriggered,started:t}));const{finishIndex:i}=r.Z.get(O.Z).value,l=n-i,d=a.get(V).value.lastIndex;Math.abs(d)===i?(p.Z.destroyComponent(a,V),o&&(0,x.nw)({type:P.p.FinishedRace})):d+1===n?(a.getMutable(V).value.lastIndex=n,o&&(0,x.nw)({type:P.p.PassedCheckpoint,checkpointIndex:n})):d-1===l&&(a.getMutable(V).value.lastIndex=l,o&&(0,x.nw)({type:P.p.PassedCheckpoint,checkpointIndex:i-n}));break}case"leaderboard":{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;t&&(0,x.nw)({type:P.p.CurlingLeaderboardTriggered});break}case"notification":{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;if(!t)return void(0,x.nw)({type:P.p.NotificationTriggered,notificationName:void 0});const{notificationName:n}=s.get(_.Z).value;(0,x.nw)({type:P.p.NotificationTriggered,notificationName:n});break}case"camera":{if(!t)return;const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;const{distance:n,minDistance:i,stiffness:l,highSpeedAngle:d,lowSpeedAngle:u}=s.get(se.Z).value;(0,x.nw)({type:P.p.CameraTriggered,distance:n?Number(n):void 0,minDistance:i?Number(i):void 0,stiffness:l?Number(l):void 0,highSpeedAngle:d?Number(d):void 0,lowSpeedAngle:u?Number(u):void 0});break}case"spawn":{if(!t)break;const{spawnPointName:e}=s.get(ie.Z).value,o=Ce.collect().entities;o.size||i.Z.Error(`No spawn point found with name ${e} in the level! Cant spawn the player.`);for(const t of o){const o=t.get(re.Z).value;if(o.name===e){const{rigidbody:e}=a.getMutable(R.Z).value;e.setTranslation((0,le.wQ)({x:0,y:0,z:0},o.translation),!0),e.setRotation((0,le.r1)({x:0,y:0,z:0,w:1},o.rotation),!0),e.setLinvel({x:0,y:0,z:0},!0),e.setAngvel({x:0,y:0,z:0},!0),o.speed&&(k.VC(Ae,[0,0,-1],o.rotation),k.bA(ke,Ae,o.speed),e.setLinvel((0,le.wQ)({x:0,y:0,z:0},ke),!0));break}}break}case"carVisualizer":{const e=r.Z.get(c.Z)?.value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)break;const{resourceId:n}=s.get(ce.Z).value;(0,x.nw)({type:P.p.CarVisualizerTriggered,value:t,resourceId:n});break}case"spikeOuter":case"spikeInner":case"spikeEcoInner01":case"spikeEcoOuter01":case"spikeEcoInner02":case"spikeEcoOuter02":case"spikeEcoInner03":case"spikeEcoOuter03":case"spikeInnerDrop":case"spikeOuterDrop":{if(me.o.find_3_spikes_tips.includes(l)&&t){const e=l;let t=!1;a.has(ve)||(a.addWithValue(ve,{isNetworked:!0,value:[e]}),t=!0);const o=a.getMutable(ve).value;o.includes(e)||(o.push(e),t=!0),t&&(0,x.nw)({type:P.p.AddCollectedItem,newCollectedItemId:e,collectedItems:[...o]})}const{playerId:e}=a.get(c.Z).value;if(r.Z.get(c.Z).value.playerId!==e)return;(0,x.nw)({type:P.p.SpikeTriggered,value:t,trigger:l});break}case"oled":{if(!t)return;const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;(0,x.nw)({type:P.p.OledTriggered});break}case"disclaimer":{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;const{disclaimerId:n}=s.get(ge.Z).value;(0,x.nw)({type:P.p.DisclaimerTriggered,value:t,disclaimerId:n});break}case"drop":{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;const{resourceId:n}=s.get(ye.Z).value;(0,x.nw)({type:P.p.DropTriggered,value:t,resourceId:n});break}case"quiz_teaser":{if(!t)return;const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;(0,x.nw)({type:P.p.NotificationTriggered,notificationName:"startGreenCircuit"});break}case"quiz_start":case"quiz_end":if(!t)return;if("quiz_start"===l){a.has(we)&&a.remove(we);{const e=r.Z.get(c.Z).value.playerId,{playerId:t}=a.get(c.Z).value;e===t&&(0,x.nw)({type:P.p.QuizStartedTriggered})}}if("quiz_end"===l&&a.has(we)){const{answers:e}=a.get(we).value,t=Object.values(e).filter((e=>e)).length;{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;e===o&&(0,x.nw)({type:P.p.QuizFinishedTriggered,correctAnswers:t,totalAnswers:me.o.eco_quiz.length})}}break;case"quiz_answer":{const{quizId:e,correctAnswer:i}=s.get(be.Z).value;let l=!1;if(t){if(a.has(we)||(a.addWithValue(we,{isNetworked:!0,value:{answers:{}}}),l=!0),l=void 0===a.getMutable(we).value.answers[e],l){const t=r.Z.get(o.Z).value.current;a.addWithValue(Ie,{isNetworked:!0,value:{triggerFrameNo:t+n.y7*n.ey,correctAnswer:i,quizId:e}})}}else a.has(Ie)&&p.Z.destroyComponent(a,Ie);{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=a.get(c.Z).value;if(e!==o)return;(0,x.nw)({type:P.p.QuizAnswerTriggered,started:t&&l})}break}}d&&t&&(0,fe.A)(a)},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.icySurface])]=(e,t)=>{const a=e[(0,ae.E)(E.Yf[E.dL.car])][0],o=e[(0,ae.E)(E.Yf[E.dL.icySurface])][0],{forward:n,side:s,turn:l}=o.get(U.Z).value;if(t)if(a.has(G))a.getMutable(G).value.counter++;else{a.addWithValue(G,{isNetworked:!0,value:{counter:1,forward:n,side:s,turn:l}});const{rigidbody:e}=a.getMutable(R.Z).value;e.setLinearDamping(.3),i.Z.Information("Added tire friction multiplier",n,s,l)}else if(!t&&a.has(G)){const e=a.getMutable(G).value;if(e.counter--,e.counter<=0){i.Z.Information("Removed tire friction multiplier"),p.Z.destroyComponent(a,G);const{rigidbody:e}=a.getMutable(R.Z).value;e.setLinearDamping(H.TD);{const e=r.Z.get(c.Z).value.playerId,{playerId:t}=a.get(c.Z).value;e===t&&(0,x.nw)({type:P.p.CarProperties,localId:a.get(te.Z).value.localId,isSliding:!1})}}}},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.portal])]=(e,t)=>{if(!t)return;const a=e[(0,ae.E)(E.Yf[E.dL.car])][0],o=e[(0,ae.E)(E.Yf[E.dL.portal])][0];if(a.has(c.Z)&&a.get(c.Z).value.playerId===(r.Z.has(c.Z)?r.Z.get(c.Z).value.playerId:void 0)){r.Z.get(Q.Z).value.current.data.index>-1?(0,X.G)(K.T.portal):(0,X.G)(K.T.portalJunction);const e=o.get(D.Z).value;(0,ue.WO)(e.levelName,e.random),(0,x.nw)({type:P.p.PortalCollision})}},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.spawnGhostModeArea])]=(e,t)=>{if(t)return;const a=e[(0,ae.E)(E.Yf[E.dL.car])][0];a.has(W.Z)&&p.Z.destroyComponent(a,W.Z)},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.crown])]=(e,t)=>{if(!t)return;const a=e[(0,ae.E)(E.Yf[E.dL.car])][0],n=e[(0,ae.E)(E.Yf[E.dL.crown])][0],s=n.getMutable(T.Z).value;if(s.taken)return;const l=r.Z.get(o.Z).value.current;s.taken=!0;const{rigidbody:c}=n.getMutable(R.Z).value;c&&(c.collider(0).setCollisionGroups(j.tK),a.addWithValue(N.Z,{isNetworked:!0,value:{targetDuration:s.targetDuration,frameOfAcquisition:l}}),(0,oe.iG)(a),i.Z.Debug("The crown is taken!"))},Te[(0,ae.E)(E.Yf[E.dL.car])]=(e,t)=>{if(!t)return;const a=e[(0,ae.E)(E.Yf[E.dL.car])][0],s=e[(0,ae.E)(E.Yf[E.dL.car])][1];let l,c;if(a.has(N.Z))l=a,c=s;else{if(!s.has(N.Z))return;c=a,l=s}const d=r.Z.get(o.Z).value.current,{targetDuration:u,frameOfAcquisition:f}=l.get(N.Z).value;(d-f)*n.yn<.5||(p.Z.destroyComponent(l,N.Z),c.addWithValue(N.Z,{isNetworked:!0,value:{targetDuration:u,frameOfAcquisition:d}}),(0,oe.iG)(c),i.Z.Debug("A player stole the crown!"))},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.curlingSurface])]=(e,t)=>{const a=e[(0,ae.E)(E.Yf[E.dL.car])][0];if(t&&a.has(Y))a.has(F)?a.getMutable(F).value.counter++:a.add(F);else if(!t&&a.has(F)){const e=a.getMutable(F).value;e.counter--,e.counter<=0&&p.Z.destroyComponent(a,F)}},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.curlingStartPoint])]=(e,t)=>{const a=e[(0,ae.E)(E.Yf[E.dL.car])][0],o=r.Z.get(c.Z)?.value.playerId,{playerId:n}=a.get(c.Z).value;o===n&&(0,x.nw)({type:P.p.CurlingHotspotTriggered,value:t})},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.dynamic])]=(e,t)=>{if(!t)return;const a=e[(0,ae.E)(E.Yf[E.dL.dynamic])][0];a.has(z.Z)&&Ne(a)},Te[(0,ae.E)(E.Yf[E.dL.dynamic]|E.Yf[E.dL.dynamic])]=(e,t)=>{if(!t)return;const a=e[(0,ae.E)(E.Yf[E.dL.dynamic])][0],o=e[(0,ae.E)(E.Yf[E.dL.dynamic])][1];a.has(z.Z)&&Ne(a),o.has(z.Z)&&Ne(o)},Te[(0,ae.E)(E.Yf[E.dL.car]|E.Yf[E.dL.muralHotspot])]=(e,t)=>{const a=e[(0,ae.E)(E.Yf[E.dL.car])][0];let s=null;if(t&&!a.has(ee)){s=e[(0,ae.E)(E.Yf[E.dL.muralHotspot])][0].get(q.Z).value.muralWallId;const t=r.Z.get(o.Z).value.current;a.addWithValue(ee,{isNetworked:!0,value:{muralWallId:s,triggerFrameNo:t+n.y7*n.Gu}})}else{if(t||!a.has(ee))return;p.Z.destroyComponent(a,ee)}const i=r.Z.get(c.Z).value.playerId,{playerId:l}=a.get(c.Z).value;i===l&&(0,x.nw)({type:P.p.MuralHotspotTriggered,muralWallId:s,started:t,duration:n.Gu})};var Ee=a(45799),Me=a(21839),Se=a(2375),De=a(60320),Re=a(73372);const je=new l.AE({world:u.Z,has:[R.Z,Se.Z,De.Z]}),xe=k.Ue(),Pe=Ee.Ue();var Le=a(23569);const We=new l.AE({world:u.Z,has:[Le.Z,R.Z,Se.Z]}),Be=Ee.Ue(),Ve=Ee.Ue(),Oe=k.Ue(),Ue=k.Ue(),Ge=k.Ue(),Fe=k.Ue(),ze=k.Ue(),Je=k.Ue(),Ye=k.Ue(),_e=.005,qe=.005,He=10,$e={x:0,y:0,z:0},Qe=new l.AE({world:u.Z,has:[W.Z,R.Z],trackAdded:!0,trackRemoved:!0});var Xe=a(72303),Ke=a(26508),et=a(58989),tt=a(20081),at=a(92903),ot=a(52038),nt=a(56067),st=a(80260),it=a(39854);const rt=new l.AE({world:u.Z,has:[re.Z]}),lt=k.Ue(),ct=k.Ue(),dt=new l.AE({world:u.Z,has:[h.Z,c.Z,d.Z]});var ut=a(24974);const ft=new l.AE({world:u.Z,has:[ut.Z,d.Z]}),gt=new l.AE({world:u.Z,has:[ut.Z,V]}),pt={x:0,y:0,z:0};var Zt=a(50222),ht=a(48366),yt=a(68199),vt=a(4424),mt=a(72366),bt=a(80523),wt=a(2934);const It=k.al(0,1,0),Ct=k.al(0,-1,0),At=k.al(0,0,1),kt=k.al(1,0,0),Tt=k.al(0,0,0),Nt=k.Ue(),Et=k.Ue(),Mt=3,St=.5,Dt=k.Ue(),Rt=k.Ue(),jt=k.Ue(),xt=k.Ue(),Pt=k.Ue(),Lt=k.Ue(),Wt=k.Ue(),Bt=k.Ue(),Vt=k.Ue(),Ot=k.Ue(),Ut=Ee.Ue(),Gt=k.Ue(),Ft=k.Ue(),zt=k.Ue(),Jt=k.Ue(),Yt=k.Ue(),_t=k.Ue(),qt=k.Ue(),Ht=k.Ue(),$t=k.Ue(),Qt=k.Ue(),Xt=k.Ue(),Kt=k.Ue(),ea=k.Ue(),ta=k.Ue(),aa={x:0,y:0,z:0},oa={x:0,y:0,z:0},na=new l.AE({world:u.Z,has:[C.Z,ut.Z,yt.Z,R.Z]}),sa=.35;function ia(e,t,a,o,n){k.$X(xt,n,t),k.kC(xt,o,xt),k.IH(e,a,xt)}function ra(e,t,a,o,s,i,r,l,c,d){const u=e.wheels[t.index];Zt.kK(Pt,u.springOrigin,s,i),Zt.UA(Lt,u.springDirection,i);const f=new J.Z.instance.Ray((0,le.wQ)(aa,Pt),(0,le.wQ)(oa,Lt)),g=j.ZP.physicsWorld.castRay(f,u.rayLength,!0,J.Z.instance.QueryFilterFlags.EXCLUDE_SENSORS,j.Xf,null,o);if(g){const e=Math.max(g.toi,1e-4),f=u.lastRayDistance-e;u.lastRayDistance=e;const p=(0,ht.ii)(e,u.rayLength,.8),Z=u.springStrength*n.yn*(0,ht.V2)(p)+f*u.springStiffness*n.yn;k.bA(Qt,Lt,-Z),k.bA(Bt,Lt,g.toi),k.IH(Vt,Pt,Bt);const h=g.collider.parent(),y=g.collider.friction();h.isFixed()?k.bM(zt):((0,le.$2)(Dt,h.translation()),(0,le.$2)(Rt,h.linvel()),(0,le.$2)(jt,h.angvel()),ia(zt,Dt,Rt,jt,Vt)),ia(Jt,s,r,l,Vt),k.$X(Wt,zt,Jt);const v=-u.angle;0===v?(k.JG(_t,At),k.JG(qt,kt)):(k.uD(_t,At,Tt,v),k.kC(qt,_t,It)),k.VC(Ht,_t,i),k.Fv(Ht,Ht),k.VC($t,qt,i),k.Fv($t,$t);const m=k.AK(Lt,Et)*d,b=Math.abs(Nt[1]*m*a),w=b*Mt*y*n.yn,I=k.AK($t,Wt)*a;k.bA(Xt,$t,Math.abs(w)<Math.abs(I)?w*Math.sign(I):I);const C=b*St*y*n.yn,A=k.AK(Ht,Wt),T=A*a,N=-2*c.throttle;k.bA(Kt,Ht,(Math.abs(C)<Math.abs(T)?C*Math.sign(T):T)+N),k.IH(ea,Xt,Kt),k.IH(ta,Qt,ea),o.applyImpulseAtPoint((0,le.wQ)(aa,ta),(0,le.wQ)(oa,Pt),!0),t.speed=-A,u.grounded=!0}else u.grounded=!1;t.distance=Math.min((0,ht.t7)(t.distance,g?.toi?.8-u.lastRayDistance-.4:-u.rayLength+sa,.1),-.4);const p=.2*Math.PI;u.type!==wt.g.FRONT_LEFT&&u.type!==wt.g.FRONT_RIGHT||(u.angle=c.steering*p,t.angle=(0,ht.t7)(t.angle,u.angle,.1))}var la=a(44963);const ca=new l.AE({world:u.Z,has:[la.Z,R.Z]});var da=a(29617),ua=a(75921),fa=a(95831),ga=a(1205);a(54663),a(14206);let pa="",Za="";"undefined"!=typeof process&&(process.env.LEADERBOARD_USERNAME,process.env.LEADERBOARD_PASSWORD);const ha=new l.AE({world:u.Z,has:[ut.Z,d.Z]}),ya=new l.AE({world:u.Z,has:[fa.Z]}),va=new l.AE({world:u.Z,has:[ga.Z]}),ma=new l.AE({world:u.Z,has:[ut.Z,Y,F],trackAdded:!0,trackRemoved:!0}),ba=new l.AE({world:u.Z,has:[ua.Z]}),wa=4,Ia=k.Ue(),Ca=da.Ue(),Aa=k.Ue(),ka={x:0,y:0,z:0},Ta={x:0,y:0,z:0},Na={x:0,y:0,z:0,w:0};function Ea(e,t,a){if(e.has(Y)){const t=e.getMutable(Y).value;t.jumpCount=0,t.totalScore=0}else e.add(Y);e.has(W.Z)||e.add(W.Z);const{rigidbody:o}=e.getMutable(R.Z).value;Sa(e,o,a),t&&(0,x.nw)({type:P.p.CurlingGameStarted,totalJumpCount:wa})}function Ma(e,t,a){if(e.has(Y)){const a=e.get(Y).value.totalScore;t&&(0,x.nw)({type:P.p.CurlingGameEnded,score:a}),p.Z.destroyComponent(e,Y)}const{rigidbody:o}=e.getMutable(R.Z).value;Sa(e,o,a)}function Sa(e,t,a){const{playerId:o}=e.get(c.Z).value,n=o%a.size;let s=-1;for(const o of a){if(s++,s!==n)continue;const a=o.has(fa.Z)?o.get(fa.Z).value:o.get(ga.Z).value;return(0,le.wQ)(Ta,a.translation),(0,le.r1)(Na,a.rotation),t.setTranslation(Ta,!1),t.setRotation(Na,!1),t.setLinvel(ka,!1),t.setAngvel(ka,!0),void(e.has(F)&&p.Z.destroyComponent(e,F))}}var Da=a(12103),Ra=a(72904),ja=a(96033),xa=a(79276);const Pa=new l.AE({world:u.Z,has:[c.Z,ee,R.Z]}),La=new l.AE({world:u.Z,has:[c.Z,d.Z,Da.Z,R.Z],trackAdded:!0,trackRemoved:!0}),Wa=new l.AE({world:u.Z,has:[ja.Z]}),Ba={x:0,y:0,z:0},Va=100,Oa=k.al(0,0,1),Ua=k.Ue(),Ga=k.Ue(),Fa=k.Ue();var za=a(39038);const Ja=new l.AE({world:u.Z,has:[za.Z,De.Z]}),Ya=2*Math.PI,_a=Ee.Ue(),qa={x:0,y:0,z:0,w:1};var Ha=a(95233);const $a=new l.AE({world:u.Z,has:[Ha.Z,R.Z]});var Qa=a(89262),Xa=a(84169),Ka=a(75224),eo=a(79514);const to=new l.AE({world:u.Z,has:[eo.Z]}),ao={rotation:[0,0,0,1],translation:[0,0,0],scale:[1,1,1]},oo={x:0,y:0,z:0},no={x:0,y:0,z:0,w:0};function so(e,t,a){const{animationStates:o}=t.getMutable(eo.Z).value;for(const s of o){if(!s.active)continue;const o=e[s.animationGroup]?.[s.clipName];if(!o)continue;const i=o.duration*(o.pingpong?2:1);let r;void 0===s.startFrame&&(s.startFrame=o.autoPlay?0:a),r=(a-s.startFrame)/n.y7,o.loop&&(r%=i),r>i&&(s.active=!1);const l=o.duration-Math.abs(r-o.duration);o.channels.forEach(((e,a)=>{if(t.has(R.Z)){const{rigidbody:a}=t.getMutable(R.Z).value;if(!a)return;(0,le.$2)(ao.translation,a.translation()),(0,le.KE)(ao.rotation,a.rotation()),Ka.O.apply(ao,e,l),a.setNextKinematicTranslation((0,le.wQ)(oo,ao.translation)),a.setNextKinematicRotation((0,le.r1)(no,ao.rotation))}else t.has(Xa.Z)&&Ka.O.apply(t.getMutable(Xa.Z).value,e,l)}))}}const io=new l.AE({world:u.Z,has:[c.Z,Ie]});var ro=a(17745);function lo(e,t){const a=e.boolean|e.oneFrameBoolean,o=t.value;Object.keys(ro.H).forEach((e=>{const t=(a&ro.H[e])===ro.H[e];o.value[e].changed=o.value[e].value!==t,o.value[e].value=t})),Object.keys(ro.P).forEach(((t,a)=>{o.value[t].changed=e[t]!==o.value[t].value,o.value[t].value=e[t]}))}const co=new l.AE({world:u.Z,has:[c.Z,b.Z,d.Z]}),uo=new l.AE({world:u.Z,has:[b.Z,ut.Z]});var fo=a(42748),go=a(72506);const po=new l.AE({world:u.Z,has:[h.Z,Se.Z,go.Z],trackMutated:[De.Z,go.Z]}),Zo=k.Ue(),ho=Ee.Ue(),yo=k.Ue(),vo=Ee.Ue(),mo=.5*n.y7;function bo(e){(function(e){!function(e){const t=w.collect().entities;for(const a of t){const{playerId:t}=a.get(c.Z).value;let o=!1;for(let n=0;n<10;n++){const i=y.YJ[t]?.[e-n];if(i){a.getMutable(b.Z).value=n>0?(0,m.$)(i):(0,v.Q)(i),(0,s.d_)()&&delete y.YJ[t][e-n],o=!0;break}}if(!o){const e=a.get(b.Z).value;a.getMutable(b.Z).value=(0,m.$)(e)}}}(e)})(e),function(){const e=co.collect().entities;for(const t of e)lo(t.get(b.Z).value,t.getMutable(d.Z))}(),function(){const e=Z.collect().mutated;for(const t of e)if(t.has(g.Z)){const e=t.get(g.Z).value;if(t.has(f.Z)){const a=t.get(f.Z).value;if(a.particleCollectibleId===e.particleCollectibleId&&a.colorCollectibleId===e.colorCollectibleId)continue;p.Z.destroyComponent(t,f.Z)}e.particleCollectibleId&&e.colorCollectibleId&&t.addWithValue(f.Z,{value:{particleCollectibleId:e.particleCollectibleId,colorCollectibleId:e.colorCollectibleId}})}else t.has(f.Z)&&p.Z.destroyComponent(t,f.Z)}(),function(e){r.Z.getMutable(o.Z).value.current=e,(0,I.V)(),function(e){const t=rt.collect().entities,a=r.Z.getMutable(Xe.Z).value;if(!a.length)return;if(!t.size)return void(a.length&&i.Z.Error("There is no spawn point found! Cant spawn the players:",a));const o=[];for(const e of t){const t=e.get(re.Z).value;o.push({entity:e,value:t})}for(let t=a.length-1;t>=0;t--){const n=a[t];let s=o.find((e=>e.value.name===n.spawnPoint));if(s||(i.Z.Error(`Spawn point given by the server couldn't be found. name: ${n.spawnPoint}`),[s]=o,i.Z.Debug("Choosing the first spawn point. will spawn the player on",s.value.name)),r.Z.has(c.Z)&&(r.Z.get(c.Z).value.playerId,n.playerProfile.playerId),n.frameNo!==e)continue;if(a.splice(t,1),-1!==a.findIndex((e=>e.playerProfile.playerId===n.playerProfile.playerId))){i.Z.Warning("we have the same player in the spawn array.");continue}i.Z.Debug("will spawn player on",n.spawnPoint);const l=s.value,d=(0,tt.Q4)(n.playerProfile.selectedCar),{rigidbody:u}=d.getMutable(R.Z).value;if(u.setTranslation((0,le.wQ)({x:0,y:0,z:0},l.translation),!0),u.setRotation((0,le.r1)({x:0,y:0,z:0,w:1},l.rotation),!0),l.speed&&(k.VC(lt,[0,0,-1],l.rotation),k.bA(ct,lt,l.speed),u.setLinvel((0,le.wQ)({x:0,y:0,z:0},ct),!0)),d.addWithValue(c.Z,{isNetworked:!0,value:{playerId:n.playerProfile.playerId}}),d.addWithValue(et.Z,{isNetworked:!0,value:{playerName:n.playerProfile.playerName}}),d.addWithValue(nt.Z,{isNetworked:!0,value:{state:n.playerProfile.state}}),r.Z.has(c.Z)){const e=r.Z.get(c.Z).value.playerId;if(n.playerProfile.playerId===e){if(r.Z.has(Ke.Z)&&p.Z.destroyComponent(r.Z,Ke.Z),r.Z.addWithValue(Ke.Z,{value:d}),(0,x.nw)({type:P.p.MuralHotspotFocus,muralWallId:void 0,started:!1}),r.Z.has(pe.Z)){const e=r.Z.getMutable(pe.Z).value;(0,x.nw)({type:P.p.PlayerSpawned,activeTrigger:{...e}}),Object.keys(e).forEach((t=>{e[t]=!1}))}(0,x.nw)({type:P.p.SetPlayerCar,carCollectibleId:n.playerProfile.selectedCar}),(0,st.Uu)()||(0,it.cW)()||at.c.addState((0,ot.R)(d,2))}}}}(e),function(e){const t=dt.collect().entities;if(!t.size)return;const a=r.Z.getMutable($.Z).value;for(const o of t){const{playerId:t}=o.get(c.Z).value,n=a.find((e=>e.playerId===t));n&&n.frameNo===e&&(i.Z.Debug("removing the player with id",t),p.Z.destroyEntity(o),a.splice(a.indexOf(n),1))}}(e),function(e){for(const t of ca.collect().entities){const{resetAfterFrames:a,lastResetFrameNo:o,translation:n,rotation:s}=t.get(la.Z).value;if(e-o>a){const{rigidbody:a}=t.getMutable(R.Z).value;a.setTranslation(n,!0),a.setRotation(s,!0),t.getMutable(la.Z).value.lastResetFrameNo=e}}}(e),function(){for(const e of A.collect().entities){const t=e.get(d.Z).value.value,a=e.getMutable(C.Z).value;let o=t.joystickV.value;o||(o+=t.w.value||t.arrowup.value?1:0,o+=t.s.value||t.arrowdown.value?-1:0);let n=t.joystickH.value;n||(n+=t.d.value||t.arrowright.value?1:0,n+=t.a.value||t.arrowleft.value?-1:0),a.throttle=o,a.steering=n,a.brake=t[" "].value,a.horn=t.h.value}}(),function(e){const{clips:t}=r.Z.get(Qa.Z).value;for(const a of to.collect().entities)so(t,a,e)}(e),function(e){if(j.ZP.physicsWorld){(0,le.$2)(Nt,j.ZP.physicsWorld.gravity),k.Fv(Et,Nt);for(const e of na.collect().entities){const t=e.getMutable(yt.Z).value,a=e.has(vt.Z)?{throttle:0,steering:0,brake:!1,horn:!1}:e.get(C.Z).value;if(e.has(M)){const t=e.get(M).value;a.throttle*=t.multiplier}const{rigidbody:o}=e.get(R.Z).value;if(!o)continue;(0,le.$2)(Ot,o.translation()),(0,le.KE)(Ut,o.rotation()),(0,le.$2)(Gt,o.linvel()),(0,le.$2)(Ft,o.angvel());const s=e.get(mt.Z).value,i=Array.from(s).filter((e=>e.has(bt.Z))),r=o.mass()/4;let l=0;const c=[];for(const e of i){const t=e.getMutable(bt.Z).value;c.push(t)}c.sort(((e,t)=>e.index-t.index));for(const e of c)ra(t,e,r,o,Ot,Ut,Gt,Ft,a,o.gravityScale()),l+=t.wheels[e.index].grounded?1:0;if(0===l&&0!==a.steering){const e=6*Math.abs(a.steering);Zt.kt(e,o,Ut,a.steering>0?Ct:It)}if(4===l&&a.throttle>.1){const e=Math.abs(Ut[0]),t=Math.abs(Ut[2]);if(e>.2||t>.2){const s=937*Math.max(e,t)*(1-.8*a.throttle);Zt.Lb(Tt,s*n.yn,o,Ot,Ut,Ct)}}const d=Math.abs(a.throttle);if(d>.1&&l<4)if(l>1)Zt.Lb(Tt,10*d,o,Ot,Ut,Ct);else{let e=!1;for(let t=0;t<o.numColliders();t++){const a=o.collider(t);a.isSensor()||j.ZP.physicsWorld.contactsWith(a,(t=>{j.ZP.physicsWorld.contactPair(a,t,(a=>{!t.isSensor()&&a.numContacts()&&(e=!0)}))}))}e&&(Zt.K(Yt,It,Ut),Zt.kt(8*d*-Math.sign(Yt[0]),o,Ut,At))}{const t=!1,o=0;(0,x.nw)({type:P.p.CarProperties,localId:e.get(te.Z).value.localId,throttle:a.throttle,horn:a.horn,slidingSpeed:o,isSliding:t,numWheelsOnGround:l})}}}}(),function(e){for(const t of Pa.collect().entities){const{muralWallId:a,triggerFrameNo:o}=t.get(ee).value;if(o<=e){p.Z.destroyComponent(t,ee),t.addWithValue(Da.Z,{isNetworked:!0,value:{muralWallId:a,timeAdded:Date.now()}});{const e=(0,xa.c)(Wa.collect().entities,(e=>e.get(ja.Z).value.id===a)).get(ja.Z).value,t=e.translation,o=e.rotation;k.VC(Ua,Oa,o),k.bA(Ga,Ua,Va),k.IH(Fa,t,Ga),at.c.addState((0,Ra.J)(Fa,t,void 0,1))}}}const t=La.collect();for(const e of t.entities){const t=e.get(d.Z).value.value;t.leaveMuralWall.changed&&t.leaveMuralWall.value&&e.has(Da.Z)&&(p.Z.destroyComponent(e,Da.Z),at.c.popState())}for(const e of t.removed){if(e.isDestroyed()||e.has(Da.Z))continue;e.has(vt.Z)&&p.Z.destroyComponent(e,vt.Z),e.has(W.Z)&&p.Z.destroyComponent(e,W.Z);const t=r.Z.get(c.Z).value.playerId,{playerId:a}=e.get(c.Z).value;t===a&&(0,x.nw)({type:P.p.MuralHotspotFocus,muralWallId:void 0,started:!1})}for(const e of t.added){if(!e.has(Da.Z))return;e.add(vt.Z),e.add(W.Z);const{rigidbody:t}=e.getMutable(R.Z).value;t.setLinvel(Ba,!1),t.setAngvel(Ba,!1);const a=r.Z.get(c.Z).value.playerId,{playerId:o}=e.get(c.Z).value;if(a===o){const{muralWallId:t}=e.get(Da.Z).value;(0,x.nw)({type:P.p.MuralHotspotFocus,muralWallId:t,started:!0})}}}(e),function(){const[e]=ba.collect().entities;if(!e)return;const{translation2d:t,radius:a}=e.get(ua.Z).value,o=ya.collect().entities;if(!o.size)return;const n=va.collect().entities;if(!n.size)return;let s=-1;r.Z.has(c.Z)&&(s=r.Z.get(c.Z).value.playerId);for(const e of ha.collect().entities){const{playerId:t}=e.get(c.Z).value,a=e.get(d.Z).value.value;a.startCurling.changed&&a.startCurling.value&&Ea(e,t===s,o),a.endCurling.changed&&a.endCurling.value&&Ma(e,t===s,n)}const i=ma.collect();for(const e of i.entities){const n=e.getMutable(Y).value;if(n.jumpCount>=wa)continue;const{playerId:i}=e.get(c.Z).value,r=i===s,{rigidbody:l}=e.getMutable(R.Z).value;(0,le.$2)(Ia,l.translation()),da.t8(Ca,Ia[0],Ia[2]);const d=da.TE(Ca,t),u=Math.max(0,100-d/a*100);r&&(0,x.nw)({type:P.p.CurlingScoreChanged,score:u});const f=l.linvel();(0,le.$2)(Aa,f),k.kE(Aa)<.7&&(n.jumpCount++,n.totalScore+=u,n.jumpCount>=wa?r&&(0,x.nw)({type:P.p.CurlingJumpEnded,jumpCount:n.jumpCount,score:u,totalScore:n.totalScore,isLastJump:!0}):(Sa(e,l,o),r&&(0,x.nw)({type:P.p.CurlingJumpEnded,jumpCount:n.jumpCount,score:u,totalScore:n.totalScore,isLastJump:!1})))}if(s>-1){for(const e of i.added){const{playerId:t}=e.get(c.Z).value;s===t&&(0,x.nw)({type:P.p.CurlingSliding,isSliding:!0})}for(const e of i.removed){if(e.isDestroyed())continue;const{playerId:t}=e.get(c.Z).value;s===t&&(0,x.nw)({type:P.p.CurlingSliding,isSliding:!1})}}}(),function(e){const t=Qe.collect();for(const e of t.added){const t=e.getMutable(R.Z).value,{rigidbody:a,colliderGroups:o}=t;if(a)for(let e=0;e<a.numColliders();e++){const t=a.collider(e);o[e]=t.collisionGroups(),o[e]!==j.tK&&t.setCollisionGroups(j.hk)}}for(const e of t.removed){if(e.isDestroyed())continue;const t=e.getMutable(R.Z).value,{rigidbody:a,colliderGroups:o}=t;if(a)for(let e=0;e<a.numColliders();e++)a.collider(e).setCollisionGroups(o[e])}for(const a of t.entities){const t=a.get(W.Z).value;t.removeInFrameNo&&t.removeInFrameNo<=e&&p.Z.destroyComponent(a,W.Z)}}(e),function(){for(const e of We.collect().entities){const t=e.get(Se.Z).value,a=e.get(Le.Z).value,{rigidbody:o}=e.getMutable(R.Z).value;if(!o)continue;Me.j6(Ve,a.targetTransform),Me.i0(ze,a.targetTransform),Ee.Bh(Oe,Ve),Ee.Bh(Ue,(0,le.KE)(Be,t.rotation)),k.$X(Ge,Oe,Ue),k.$X(Je,ze,(0,le.$2)(Fe,t.translation)),Ye[0]=qe*a.rotStiffness,Ye[1]=qe*a.rotStiffness,Ye[2]=qe*a.rotStiffness,k.Jp(Ge,Ge,Ye),Ye[0]=_e*a.posStiffness,Ye[1]=_e*a.posStiffness,Ye[2]=_e*a.posStiffness,k.Jp(Je,Je,Ye),o.setAngvel($e,!0),o.applyTorqueImpulse({x:Ge[0],y:Ge[1],z:Ge[2]},!0);const n=o.linvel(),s=k.kE([n.x,n.y,n.z]);if(s>He){const e=He/s;n.x*=e,n.y*=e,n.z*=e,o.setLinvel(n,!0)}o.applyImpulse({x:Je[0],y:Je[1],z:Je[2]},!0)}}(),(0,oe.ZP)(e),function(e){if(!r.Z.has(O.Z))return;const{timeLimitInFrames:t,finishIndex:a,translation:o,rotation:n}=r.Z.get(O.Z).value;for(const s of ft.collect().entities){const l=s.get(d.Z).value.value;if(l.startRacing.changed&&l.startRacing.value&&!s.has(V)){s.addWithValue(V,{isNetworked:!0,value:{lastIndex:0,startFrame:e}});const{rigidbody:l}=s.getMutable(R.Z).value;l.setTranslation(o,!1),l.setRotation(n,!1),l.setLinvel(pt,!1),l.setAngvel(pt,!0),i.Z.Information("Race has started.");{const e=r.Z.get(c.Z).value.playerId,{playerId:o}=s.get(c.Z).value;e===o&&(0,x.nw)({type:P.p.StartedRace,timeLimitInFrames:t,finishIndex:a})}}if(l.endRacing.changed&&l.endRacing.value&&s.has(V)){p.Z.destroyComponent(s,V);{const e=r.Z.get(c.Z).value.playerId,{playerId:t}=s.get(c.Z).value;e===t&&(0,x.nw)({type:P.p.AbortedRace})}}}for(const a of gt.collect().entities){const{startFrame:o}=a.get(V).value;if(o+t>e)continue;p.Z.destroyComponent(a,V);const n=r.Z.get(c.Z).value.playerId,{playerId:s}=a.get(c.Z).value;n===s&&(0,x.nw)({type:P.p.FailedRace})}}(e),function(e){for(const t of io.collect().entities){const{triggerFrameNo:a,correctAnswer:o,quizId:n}=t.get(Ie).value;a<=e&&(p.Z.destroyComponent(t,Ie),i.Z.Debug("Set quiz answer","quizId",n,"correctAnswer",o),t.getMutable(we).value.answers[n]=!!o,r.Z.get(c.Z).value.playerId===t.get(c.Z).value.playerId&&(0,x.nw)({type:P.p.QuizAnswerSelected,quizId:n,isCorrectAnswer:o}))}}(e),j.ZP.eventQueue?.drainCollisionEvents(((e,t,a)=>{const o=j.ZP.physicsWorld.getCollider(e),n=j.ZP.physicsWorld.getCollider(t),{objectType:s,entity:i}=o.parent()?.userData,{objectType:r,entity:l}=n.parent()?.userData,c=E.Yf[s],d=E.Yf[r];c===d?Te[(0,ae.E)(c)]?.({[(0,ae.E)(c)]:[i,l]},a):Te[(0,ae.E)(c|d)]?.({[(0,ae.E)(c)]:[i],[(0,ae.E)(d)]:[l]},a);const{rigidbody:u}=(s===E.dL.static?l:i).get(R.Z).value,f=u.linvel(),g=u.translation();(0,x.nw)({type:P.p.Collision,collisionType:c|d,speed:k.kE([f.x,f.y,f.z]),translation:[g.x,g.y,g.z]})})),j.ZP.physicsWorld?.step(j.ZP.eventQueue),function(){for(const e of je.collect().entities){const{rigidbody:t}=e.get(R.Z).value;if(!t)continue;const a=e.getMutable(Se.Z).value;a.bodyType=t.bodyType();const o=[];for(let e=0;e<t.numColliders();e++){const a=t.collider(e);o[e]={isSensor:a.isSensor(),collisionGroups:a.collisionGroups()}}a.colliders=o,a.translation=t.translation(),a.rotation=t.rotation(),a.linvel=t.linvel(),a.angvel=t.angvel();const n=e.getMutable(De.Z).value;e.has(Re.Z)?((0,le.KE)(Pe,a.rotation),Me.en(n,Pe)):((0,le.$2)(xe,a.translation),(0,le.KE)(Pe,a.rotation),Me.yl(n,Pe,xe))}}(),function(){for(const e of Ja.collect().entities){if(e.isDestroyed())continue;const{axis:t,speed:a}=e.get(za.Z).value,o=e.getMutable(De.Z).value;if(Me.U1(o,o,a*n.yn*Ya,t),e.has(R.Z)){const{rigidbody:t}=e.get(R.Z).value;Me.j6(_a,o),(0,le.r1)(qa,_a),t.setNextKinematicRotation(qa)}}}(),function(e){const t=$a.collect().entities;for(const a of t){const t=a.get(Ha.Z).value;if(t.frameNo>e)continue;p.Z.destroyComponent(a,Ha.Z);const o=(0,tt.Q4)(t.collectibleId);o.has(W.Z)&&p.Z.destroyComponent(o,W.Z);const{rigidbody:n}=a.getMutable(R.Z).value,{rigidbody:s}=o.getMutable(R.Z).value;s.setTranslation(n.translation(),!1),s.setRotation(n.rotation(),!1),s.setLinvel(n.linvel(),!1),s.setAngvel(n.angvel(),!0);const i=a.getAll();for(const e of Object.getOwnPropertySymbols(i))o.has([e,void 0])||o.addWithValue([e,void 0],a.getMutable([e,void 0]));if(a.has(N.Z)&&(p.Z.destroyComponent(a,N.Z),(0,oe.iG)(o,!0)),a.has(g.Z)){const e=o.getMutable(g.Z).value,{colorCollectibleId:t,particleCollectibleId:n}=a.get(g.Z).value;e.colorCollectibleId=t,e.particleCollectibleId=n}if(p.Z.destroyEntity(a),r.Z.has(c.Z)){const e=r.Z.get(c.Z).value.playerId,{playerId:t}=o.get(c.Z).value;t===e&&(r.Z.getMutable(Ke.Z).value=o,(0,st.Uu)()||(0,it.cW)()||at.c.addState((0,ot.R)(o)))}}}(e),at.c.update(e)}(e),function(e){for(const t of po.collect().mutated){const a=t.get(go.Z).value;if(a.frameNo!==e)continue;const o=t.get(Se.Z).value;t.has(fo.Z)||t.add(fo.Z);const n=t.getMutable(fo.Z).value;(0,le.$2)(Zo,o.translation),(0,le.KE)(ho,o.rotation),k.$X(yo,Zo,a.trs.translation),Ee.U_(ho,ho),Ee.Jp(vo,ho,a.trs.rotation),k.IH(n.translation,n.translation,yo),Ee.Jp(n.rotation,n.rotation,vo)}}(e),function(){for(const e of uo.collect().entities)e.getMutable(b.Z).value.oneFrameBoolean=0}()}function wo(){const e=r.Z.getMutable(o.Z).value;if((0,s.d_)()&&(e.target=e.current+1),e.target-e.current>1&&i.Z.Debug("frame count to simulate at once: ",e.target-e.current),e.target-e.current>mo)return e.current=-1,e.target=-1,void i.Z.Debug("Too many frames to simulate. Waiting for the next server snapshot to continue simulating.");for(let t=e.current+1;t<=e.target;t+=1)e.current=t,bo(t)}},89942:(e,t,a)=>{a.d(t,{N:()=>M});var o=a(53393),n=a(7962),s=a(21839),i=a(34689),r=a(13008),l=a(41465),c=a(57814),d=a(28876),u=a(53241),f=a(29210),g=a(86582),p=a(60320),Z=a(63805),h=a(51818),y=a(25721),v=a(48366);const m=1.5,b=m+.5,w=10,I=.5,C=I/b*.4,A=I+w*C+.3,k=new o.AE({world:i.Z,has:[l.Z,r.Z]}),T=n.Ue();function N(){const e=h.q.getGameobjectsByType(Z.dL.spawnRing)[0]?.gameobjectDef;if(!e)return null;const t=c.Z.createEntity([p.Z,r.Z],!1),a=(0,f.fh)();return t.getMutable(r.Z).sharedBuffer=a,(0,g.nw)({type:d.p.AddGameobject,objectName:e.name,localId:t.get(u.Z).value.localId,sharedWorldTransformByteOffset:a.byteOffset}),(0,g.nw)({type:d.p.SpawnAnimationStarted}),t}let E=performance.now();function M(){const e=k.collect(),t=performance.now(),a=(t-E)/1e3;E=t;for(const t of e.entities){const e=t.getMutable(l.Z).value;e.time+=a;for(let a=0;a<w;a++){const o=(0,v.V2)((e.time-C*a)/I);if(!e.rings[a]){if(!(o>0))continue;e.rings[a]=N(),(0,y.VC)(t,e.rings[a])}const n=m-o*b,i=e.rings[a].getMutable(p.Z).value;s.i0(T,i),T[1]=n,s.vc(i,T)}e.time>A&&(c.Z.destroyComponent(t,l.Z),(0,g.nw)({type:d.p.SpawnAnimationFinished}))}}},91811:(e,t,a)=>{a.d(t,{y:()=>d});var o=a(53393),n=a(21839),s=a(84169),i=a(60320),r=a(34689);const l=new o.AE({world:r.Z,has:[s.Z,i.Z],trackAdded:!0,trackMutated:[s.Z]});function c(e){const t=e.get(s.Z).value,a=e.getMutable(i.Z).value;n.Iw(a,t.rotation,t.translation,t.scale)}function d(){const e=l.collect();for(const t of e.added)c(t);for(const t of e.mutated)c(t)}},26986:(e,t,a)=>{var o,n;a.d(t,{P:()=>o,x:()=>n}),function(e){e[e.Ping=0]="Ping",e[e.Pong=1]="Pong",e[e.PlayerRegistration=2]="PlayerRegistration",e[e.PlayerRegistrationConfirmation=3]="PlayerRegistrationConfirmation",e[e.PlayerProfileUpdate=4]="PlayerProfileUpdate",e[e.PlayerSpawnRequest=5]="PlayerSpawnRequest",e[e.PlayerRemoveRequest=6]="PlayerRemoveRequest",e[e.PlayerFrameInput=7]="PlayerFrameInput",e[e.PlayerActions=8]="PlayerActions",e[e.UserInputBundle=9]="UserInputBundle",e[e.Snaphot=10]="Snaphot",e[e.ChatResponse=11]="ChatResponse",e[e.MuralTextureUpdate=12]="MuralTextureUpdate",e[e.MuralGenerationStatus=13]="MuralGenerationStatus",e[e.MuralSubmissionStatus=14]="MuralSubmissionStatus",e[e.MuralUserFeedback=15]="MuralUserFeedback",e[e.ResourcesUpdated=16]="ResourcesUpdated",e[e.CollectiblesUpdated=17]="CollectiblesUpdated",e[e.AchievementsUpdated=18]="AchievementsUpdated",e[e.LiveEventsUpdated=19]="LiveEventsUpdated"}(o||(o={})),function(e){e[e.Accepted=0]="Accepted",e[e.BadWording=1]="BadWording"}(n||(n={}))},68988:(e,t,a)=>{var o;a.d(t,{T:()=>o}),function(e){e[e.portal=0]="portal",e[e.link=1]="link",e[e.portalJunction=2]="portalJunction",e[e.quizLevel=3]="quizLevel"}(o||(o={}))},21150:(e,t,a)=>{a.d(t,{t:()=>u});var o=a(21839),n=a(57814),s=a(13008),i=a(86582),r=a(28876),l=a(53241),c=a(29210),d=a(60320);function u(e,t,a){const u=n.Z.createEntity([d.Z,s.Z],!1);u.addWithValue(t,{value:a});const f=u.getMutable(d.Z);o.cf(f.value,f.value,0);const g=(0,c.fh)();u.getMutable(s.Z).sharedBuffer=g,(0,i.nw)({type:r.p.AddGameobject,objectName:e.name,localId:u.get(l.Z).value.localId,sharedWorldTransformByteOffset:g.byteOffset})}}}]);